<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Title</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="./src/fontawesome/css/all.css">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
	<script src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>
</head>

<body>
	<main style="gap: 112px; padding: 40px;">
		<div class="boox-wrapper quadrate rhombus">
			<button type="button" class="connection-top connection">
				<div class="dot"><i class="fa-arrow-up fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-right connection">
				<div class="dot"><i class="fa-arrow-right fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-bottom connection">
				<div class="dot"><i class="fa-arrow-down fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-left connection">
				<div class="dot"><i class="fa-arrow-left fas saIcon"></i></div>
			</button>
			<div class="boox">
				<div class="boox-inner">
					<div type="text" class="boox-title" contenteditable="true">Hej på dig min lilla vän. Och
						lila vän, alltså
						kulören lila.</div>
					<div type="text" class="boox-desc" contenteditable="true">Hej på dig min lilla vän.;</div>
				</div>
			</div>

			<div class="shape"></div>
		</div>

		<div class="boox-wrapper circle quadrate">
			<button type="button" class="connection-top connection">
				<div class="dot"><i class="fa-arrow-up fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-right connection">
				<div class="dot"><i class="fa-arrow-right fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-bottom connection">
				<div class="dot"><i class="fa-arrow-down fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-left connection">
				<div class="dot"><i class="fa-arrow-left fas saIcon"></i></div>
			</button>
			<div class="boox">
				<div class="boox-inner">
					<div type="text" class="boox-title" contenteditable="true">
						Pellentesque pretium sodales ipsum et finibus. Ut et dignissim erat, facilisis euismod elit.
						Phasellus nibh lacus, laoreet ut egestas at, fringilla eget arcu. Nulla imperdiet hendrerit
						magna, ac blandit leo pharetra ac. Pellentesque vel aliquet ante, eu volutpat sapien.
						Suspendisse ut sapien non massa efficitur cursus ut elementum lectus. Ut accumsan dui ac odio
						malesuada bibendum. Fusce at consectetur quam.
					</div>
					<div type="text" class="boox-desc" contenteditable="true">
						Pellentesque pretium sodales ipsum et finibus. Ut et dignissim erat, facilisis euismod elit.
						Phasellus nibh lacus, laoreet ut egestas at, fringilla eget arcu. Nulla imperdiet hendrerit
						magna, ac blandit leo pharetra ac. Pellentesque vel aliquet ante, eu volutpat sapien.
						Suspendisse ut sapien non massa efficitur cursus ut elementum lectus. Ut accumsan dui ac odio
						malesuada bibendum. Fusce at consectetur quam.
					</div>
				</div>
			</div>
			<div class="shape">
			</div>
		</div>

		<div class="boox-wrapper quadrate square">
			<button type="button" class="connection-top connection">
				<div class="dot"><i class="fa-arrow-up fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-right connection">
				<div class="dot"><i class="fa-arrow-right fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-bottom connection">
				<div class="dot"><i class="fa-arrow-down fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-left connection">
				<div class="dot"><i class="fa-arrow-left fas saIcon"></i></div>
			</button>
			<div class="boox">
				<div class="boox-inner">
					<div type="text" class="boox-title" contenteditable="true">
						Pellentesque pretium sodales ipsum et finibus.
					</div>
					<div type="text" class="boox-desc" contenteditable="true">
						Fringilla eget arcu. Nulla imperdiet hendrerit magna, ac blandit leo pharetra ac. Pellentesque
						vel aliquet ante, eu volutpat sapien.
					</div>
				</div>
			</div>
			<div class="shape">
			</div>
		</div>

		<div class="boox-wrapper quadrate rhombus">
			<button type="button" class="connection-top connection">
				<div class="dot"><i class="fa-arrow-up fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-right connection">
				<div class="dot"><i class="fa-arrow-right fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-bottom connection">
				<div class="dot"><i class="fa-arrow-down fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-left connection">
				<div class="dot"><i class="fa-arrow-left fas saIcon"></i></div>
			</button>
			<div class="boox">
				<div class="boox-inner">
					<div type="text" class="boox-title" contenteditable="true">Hej på dig min lilla vän. Och
						lila vän, alltså
						kulören lila. Hej på dig min lilla vän. Och lila vän, alltså kulören lila. Hej på dig min lilla
						vän. Och lila vän, alltså kulören lila. Hej på dig min lilla vän. Och lila vän, alltså kulören
						lila.</div>
					<div type="text" class="boox-desc" contenteditable="true">Hej på dig min lilla vän. Och
						lila vän, alltså
						kulören lila. Hej på dig min lilla vän. Och lila vän, alltså kulören lila. Hej på dig min lilla
						vän. Och lila vän, alltså kulören lila. Hej på dig min lilla vän. Och lila vän, alltså kulören
						lila.</div>
				</div>
			</div>
			<div class="shape">
			</div>
		</div>
		<div class="boox-wrapper subroutine">
			<button type="button" class="connection-top connection">
				<div class="dot"><i class="fa-arrow-up fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-right connection">
				<div class="dot"><i class="fa-arrow-right fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-bottom connection">
				<div class="dot"><i class="fa-arrow-down fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-left connection">
				<div class="dot"><i class="fa-arrow-left fas saIcon"></i></div>
			</button>
			<div class="boox">
				<div class="boox-inner">
					<div type="text" class="boox-title" contenteditable="true">
						Hej på dig.
					</div>
					<div type="text" class="boox-desc" contenteditable="true">
						Hej på dig min lilla vän.
					</div>
				</div>
			</div>
			<div class="shape">
			</div>
		</div>
		<div class="boox-wrapper input">
			<button type="button" class="connection-top connection">
				<div class="dot"><i class="fa-arrow-up fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-right connection">
				<div class="dot"><i class="fa-arrow-right fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-bottom connection">
				<div class="dot"><i class="fa-arrow-down fas saIcon"></i></div>
			</button>
			<button type="button" class="connection-left connection">
				<div class="dot"><i class="fa-arrow-left fas saIcon"></i></div>
			</button>
			<div class="boox">
				<div class="boox-inner">
					<div type="text" class="boox-title" contenteditable="true">
						Pellentesque pretium sodales ipsum et finibus.
					</div>
					<div type="text" class="boox-desc" contenteditable="true">
						Fringilla eget arcu. Nulla imperdiet hendrerit magna.
					</div>
				</div>
			</div>
			<div class="shape">
			</div>
		</div>
	</main>

	<style>
		main {
			display: flex;
			gap: 24px;
			padding: 24px;
			flex-direction: column;
		}
	</style>
	<script>

		$(document).ready(function () {
			function adjustPadding() {
				$('.boox-wrapper.input').each(function () {
					var $this = $(this);
					var elementWidth = $this.outerWidth();
					var elementHeight = $this.outerHeight();
					var skewAngle = 20 * (Math.PI / 180);

					// Calculate the additional padding needed to compensate for the skew
					var additionalPadding = Math.round(Math.tan(skewAngle) * elementHeight / 2);
					$this.css({
						'padding-left': additionalPadding + 'px',
						'padding-right': additionalPadding + 'px'
					});

					var skewedWidth = elementWidth / Math.cos(skewAngle);

					var adjustedWidth = Math.min(elementWidth, skewedWidth);

					$this.find('.shape').css({
						'width': Math.round(adjustedWidth) - 32 + 'px'
					});
					console.log(Math.round(adjustedWidth));
				});
			}

			adjustPadding();



			$('.boox-wrapper').click(function () {
				$('.boox-wrapper').removeClass('selected');
				$(this).addClass('selected');
			});

			function positionElements() {
				let gap = 80;
				$('.boox-wrapper').each(function (index) {
					$(this).css({
						position: 'absolute',
						left: '80px',
						top: index * gap + 'px'
					});
				});
			}

			positionElements();


			$('.boox-wrapper').draggable({
				grid: [16, 16],
				start: function (event, ui) {
					$(this).addClass('dragging');
				},
				stop: function (event, ui) {
					$(this).removeClass('dragging');
				}
			});



			$(function () {
				$('.boox-wrapper').resizable({
					maxHeight: 1200,
					maxWidth: 1200,
					minHeight: 112,
					minWidth: 112,
					grid: 16,
					handles: 'n, ne, e, se, s, sw, w, nw',
					start: function (event, ui) {
						$(this).addClass('resize');
						adjustPadding();
					},
					stop: function (event, ui) {
						$(this).removeClass('resize');
						adjustPadding();
					}
				});

				$('.boox-wrapper.quadrate').resizable({
					aspectRatio: 1 / 1,
					stop: function (event, ui) {
						$(this).height('');
						$(this).removeClass('resize');
					}
				});
			});


			function snapToGrid(width, gridSize) {
				return Math.ceil(width / gridSize) * gridSize;
			}

			function adjustWidths() {
				let wrappers = $('.boox-wrapper.quadrate');
				let inners = $('.boox-inner');
				for (let i = 0; i < wrappers.length; i++) {
					let wrapper = wrappers[i];
					let inner = inners[i];
					for (let startWidth = 600; startWidth > 0; startWidth -= 2) {
						wrapper.style.width = startWidth + 'px';
						if (inner.scrollHeight > inner.clientHeight) {
							let finalWidth = snapToGrid(startWidth + 2, 16);
							wrapper.style.width = finalWidth + 'px';
							wrapper.style.height = '';
							adjustPadding();
							break;
						}
					}
				}
			}

			// Adjust on double click
			$('.boox-wrapper.quadrate').on('dblclick keydown', function () {
				adjustWidths(this);
				adjustPadding();
			});

			let wrappers = $('.boox-wrapper.quadrate');

			wrappers.each(function () {
				let wrapper = this;
				let resizeObserver = new ResizeObserver(() => {
					let currentWidth = wrapper.clientWidth;
					wrapper.style.width = snapToGrid(currentWidth, 16) + 'px';
					adjustPadding();
				});

				resizeObserver.observe(wrapper);
			});

			setTimeout(() => {
				adjustWidths();
			}, 200);
		});

	</script>



</body>

</html>