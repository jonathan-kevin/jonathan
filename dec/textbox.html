<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Jonathan</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="../src/fontawesome/css/all.css">

	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
	<script type="text/javascript" src="https://livejs.com/live.js"></script>
	<link rel="icon" type="image/png" size="16x16" href="../src/img/favicon.svg">
</head>

<body class="saRootBody saLargeScreen saPc saCompact">
	<div class="saRootContentWrapper">
		<div class="saRightFrameRoot">
			<div class="right standardview saPc saLargeScreen saCompact">
				<div class="pagecontentframe">
					<form class="interface">
						<div class="maincolinner gradients">
							<main id="MI_M" class="menuitem pagecontentframe">
								<div id="MI_ScrollIndicator" class="scrollindicator"></div>
								<div id="MI_ScrollContent" class="scrollcontent saScrollable">
									<div class="scrollcontent-inner" style="display: flex; flex-direction: column; gap: 1rem;">
										<div class="maincolbody saInputPage">
											<div class="saFormRoot saLabelsAbove">
												<fieldset class="saSectionWrapper">
													<legend class="saSectionHeaderWrapper">
														<div class="saSectionHeader">
															<h2>Grunduppgifter</h2>
														</div>
													</legend>

													<div class="saFieldCollection">
														<div class="saFieldAndLabelWrapper">
															<label class="saLabelCell" for="dataType">
																<div class="saLabel"><span class="saMandatory">Textbox with native data-list attribute<span class="saMandatoryStar" aria-label="oblig">*</span></span></div>
															</label>
															<div class="saFieldCell">
																<div class="saInputWrapper long">
																	<div class="saInput">
																		<div class="saInputTextWrapper saInputPageField mediumLong">
																			<input class="saInputText saDropdown" type="text" name="$1" list="dataTypeList" id="dataType" >
																			<div class="saTrailingIconsWrapper">
																				<i class="saIcon far fa-angle-down"></i>
																			</div>
																			<datalist id="dataTypeList">
																				<optgroup>
																					<option value="Henkesträng"></option>
																					<option value="PK char(4)"></option>
																					<option value="Apa"></option>
																					<option value="bit"></option>
																				</optgroup>
																				<optgroup>
																					<option value="int"></option>
																					<option value="tinyint"></option>
																					<option value="smallint"></option>
																					<option value="bigint"></option>
																				</optgroup>
																				<optgroup>
																					<option value="varchar(300)"></option>
																					<option value="varchar(max)"></option>
																					<option value="nvarchar(300)"></option>
																					<option value="nvarchar(max)"></option>
																					<option value="numeric"></option>
																				</optgroup>
																				<optgroup>
																					<option value="datetime2"></option>
																					<option value="date"></option>
																					<option value="time"></option>
																					<option value="datetimeoffset(2)"></option>
																				</optgroup>
																				<optgroup>
																					<option value="uniqueidentifier"></option>
																					<option value="varbinary(max)"></option>
																				</optgroup>
																			</datalist>
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="saFieldAndLabelWrapper">
															<label class="saLabelCell" for="dataType2">
																<div class="saLabel"><span class="saMandatory">Textbox with filtered dropdown<span class="saMandatoryStar" aria-label="oblig">*</span></span></div>
															</label>
															<div class="saFieldCell">
																<div class="saInputWrapper long">
																	<div class="saInput">
																		<div class="saInputTextWrapper saInputPageField mediumLong">
																			<input type="text" class="saInputText saDropdown" name="$2" aria-controls="dataType2-list" aria-expanded="false" id="dataType2" aria-activedescendant="" role="combobox" autocomplete="off">
																			<div class="saTrailingIconsWrapper">
																				<i class="saIcon far fa-angle-down"></i>
																			</div>
																			<ul id="dataType2-list" class="saContextMenu saSouth" role="listbox" aria-label="Data types" hidden style="top: 2.25rem;">
																				<li id="opt1" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">Henkesträng</div></div></li>
																				<li id="opt2" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">PK char(4)</div></div></li>
																				<li id="opt3" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">Apa</div></div></li>
																				<li role="presentation"><hr></li>
																				<li id="opt4" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">bit</div></div></li>
																				<li id="opt5" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">int</div></div></li>
																				<li id="opt6" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">tinyint</div></div></li>
																				<li id="opt7" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">smallint</div></div></li>
																				<li id="opt8" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">bigint</div></div></li>
																				<li role="presentation"><hr></li>
																				<li id="opt9" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">varchar(300)</div></div></li>
																				<li id="opt10" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">varchar(max)</div></div></li>
																				<li id="opt11" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">nvarchar(300)</div></div></li>
																				<li id="opt12" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">nvarchar(max)</div></div></li>
																				<li id="opt13" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">numeric</div></div></li>
																				<li role="presentation"><hr></li>
																				<li id="opt14" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">datetime2</div></div></li>
																				<li id="opt15" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">date</div></div></li>
																				<li id="opt16" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">time</div></div></li>
																				<li id="opt17" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">datetimeoffset(2)</div></div></li>
																				<li role="presentation"><hr></li>
																				<li id="opt18" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">uniqueidentifier</div></div></li>
																				<li id="opt19" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">varbinary(max)</div></div></li>
																			</ul>
																		</div>
																	</div>
																</div>
															</div>
														</div>

														<div class="saFieldAndLabelWrapper">
															<label class="saLabelCell" for="dataType3">
																<div class="saLabel"><span class="saMandatory">Textbox with Dropdown<span class="saMandatoryStar" aria-label="oblig">*</span></span></div>
															</label>
															<div class="saFieldCell">
																<div class="saInputWrapper long">
																	<div class="saInput">
																		<div class="saInputTextWrapper saInputPageField mediumLong">
																			<input class="saInputText" id="dataType3" role="combobox" name="$3" aria-expanded="false" autocomplete="off">
																			<div class="saTrailingIconsWrapper">
																				<button class="saActionIcon" tabindex="-1" type="button" aria-label="Visa/göm lista" aria-expanded="false">
																					<i class="saIcon fas fa-caret-down"></i>
																				</button>
																			</div>
																			<ul id="dataType3-list" class="saContextMenu saSouth" role="listbox" aria-label="Data types" hidden style="top: 2.25rem;">
																				<li id="optX1" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">Henkesträng</div></div></li>
																				<li id="optX2" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">PK char(4)</div></div></li>
																				<li id="optX3" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">Apa</div></div></li>
																				<li id="optX4" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">bit</div></div></li>
																				<li id="optX5" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">int</div></div></li>
																				<li id="optX6" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">tinyint</div></div></li>
																				<li id="optX7" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">smallint</div></div></li>
																				<li id="optX8" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">bigint</div></div></li>
																				<li id="optX9" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">varchar(300)</div></div></li>
																				<li id="optX10" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">varchar(max)</div></div></li>
																				<li id="optX11" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">nvarchar(300)</div></div></li>
																				<li id="optX12" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">nvarchar(max)</div></div></li>
																				<li id="optX13" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">numeric</div></div></li>
																				<li id="optX14" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">datetime2</div></div></li>
																				<li id="optX15" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">date</div></div></li>
																				<li id="optX16" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">time</div></div></li>
																				<li id="optX17" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">datetimeoffset(2)</div></div></li>
																				<li id="optX18" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">uniqueidentifier</div></div></li>
																				<li id="optX19" class="saOptionWrapper" role="option" aria-selected="false"><div class="saOption"><div class="saOptionText">varbinary(max)</div></div></li>
																			</ul>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</fieldset>
											</div>
										</div>
									</div>
								</div>
							</main>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<script>
		$(document).ready(function () {

			//NEW dropdown behavior
			(function () {
				const $input = $('#dataType2');
				const $list = $('#dataType2-list');
				const $options = $list.find('[role="option"]');

				let index = -1;

				function openList() {
					$list.addClass('saOpen').attr('hidden', false);
					$input.attr('aria-expanded', 'true');
				}

				function closeList() {
					$list.removeClass('saOpen').attr('hidden', true);
					$input.attr('aria-expanded', 'false');
					clearFocus();
					index = -1;
				}

				function clearFocus() {
					$options
						.removeClass('saFocus')
						.attr('aria-selected', 'false');
					$input.removeAttr('aria-activedescendant');
				}

				function setActive(newIndex) {
					const $visibleOptions = $options.filter(':visible');
					if (!$visibleOptions.length) return;

					index = (newIndex + $visibleOptions.length) % $visibleOptions.length;

					clearFocus();

					const $active = $visibleOptions.eq(index);
					$active
						.addClass('saFocus')
						.attr('aria-selected', 'true');

					$input.attr('aria-activedescendant', $active.attr('id'));

					// Ensure visibility in scroll container
					$active[0].scrollIntoView({ block: 'nearest' });
				}

				function commitSelection() {
					if (index < 0) return;

					const $visibleOptions = $options.filter(':visible');
					const $selected = $visibleOptions.eq(index);

					$input.val(
						$selected.find('.saOptionText').text()
					);

					closeList();
				}

				function filterOptions(query) {
					const q = query.toLowerCase();
					let hasVisibleOptions = false;

					$options.each(function () {
						const text = $(this)
							.find('.saOptionText')
							.text()
							.toLowerCase();

						const isVisible = text.includes(q);
						$(this).toggle(isVisible);
						if (isVisible) hasVisibleOptions = true;
					});

					$list.find('[role="presentation"]').each(function () {
					const $hr = $(this);

					// Look upwards until another HR or top
					const hasVisibleAbove = $hr
						.prevUntil('[role="presentation"]', '[role="option"]')
						.filter(':visible')
						.length > 0;

					// Look downwards until another HR or bottom
					const hasVisibleBelow = $hr
						.nextUntil('[role="presentation"]', '[role="option"]')
						.filter(':visible')
						.length > 0;

					$hr.toggle(hasVisibleAbove && hasVisibleBelow);
					});

					index = -1;
					clearFocus();

					if (!$options.filter(':visible').length) {
						closeList();
					}
				}

				// ===== Events =====

				$input.on('focus input', function () {
					openList();
					filterOptions(this.value);
				});

				$input.on('keydown', function (e) {
					switch (e.key) {
						case 'ArrowDown':
							e.preventDefault();
							setActive(index + 1);
							break;

						case 'ArrowUp':
							e.preventDefault();
							setActive(index - 1);
							break;

						case 'Enter':
							e.preventDefault();
							commitSelection();
							break;

						case 'Escape':
							closeList();
							break;

						case 'Tab':
							closeList();
							break;
					}
				});

				$options.on('mousedown', function () {
					const $clicked = $(this);

					$input.val(
						$clicked.find('.saOptionText').text()
					);

					closeList();
				});

				$(document).on('mousedown', function (e) {
					if (!$(e.target).closest('#dataType2-list, #dataType2').length) {
						closeList();
					}
				});
			})();




			//Old dropdown behavior
			(function () {
				const $input = $('#dataType3');
				const $list = $('#dataType3-list');
				const $options = $list.find('[role="option"]');
				const $btn = $('.saActionIcon');

				let index = -1;

				function openList() {
					$list.addClass('saOpen').attr('hidden', false);
					$input.attr('aria-expanded', 'true');
					$btn.attr('aria-expanded', 'true');
				}

				function closeList() {
					$list.removeClass('saOpen').attr('hidden', true);
					$input.attr('aria-expanded', 'false');
					$btn.attr('aria-expanded', 'false');
					clearFocus();
					index = -1;
				}

				function clearFocus() {
					$options
						.removeClass('saFocus')
						.attr('aria-selected', 'false');
					$input.removeAttr('aria-activedescendant');
				}

				function setActive(newIndex) {
					const $visibleOptions = $options.filter(':visible');
					if (!$visibleOptions.length) return;

					index = (newIndex + $visibleOptions.length) % $visibleOptions.length;

					clearFocus();

					const $active = $visibleOptions.eq(index);
					$active
						.addClass('saFocus')
						.attr('aria-selected', 'true');

					$input.attr('aria-activedescendant', $active.attr('id'));

					// Ensure visibility in scroll container
					$active[0].scrollIntoView({ block: 'nearest' });
				}

				function commitSelection() {
					if (index < 0) return;

					const $visibleOptions = $options.filter(':visible');
					const $selected = $visibleOptions.eq(index);

					$input.val(
						$selected.find('.saOptionText').text()
					);

					closeList();
				}



				$btn.on('click', function () {
					openList();
				});

				$input.on('keydown', function (e) {
					switch (e.key) {
						case 'ArrowDown':
							if (e.altKey) {
								e.preventDefault();
								openList();
							} else {
								e.preventDefault();
								setActive(index + 1);
							}
							break;

						case 'ArrowUp':
							e.preventDefault();
							setActive(index - 1);
							break;

						case 'Enter':
							e.preventDefault();
							commitSelection();
							break;

						case 'Escape':
							closeList();
							break;

						case 'Alt ArrowDown':
							openList();
							break;
					}
				});

				$options.on('mousedown', function () {
					const $clicked = $(this);

					$input.val(
						$clicked.find('.saOptionText').text()
					);

					closeList();
				});

				$(document).on('mousedown', function (e) {
					if (!$(e.target).closest('#dataType3-list, #dataType3').length) {
						closeList();
					}
				});
			})();
		});
	</script>
</body>