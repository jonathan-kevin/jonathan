<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lightbox</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="./src/fontawesome/css/all.css">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
</head>

<body>
	<div class="saRootContentWrapper">
		<div class="saSideBar saSideBarJs saExpanded">
			<nav id="SideBar">
				<div class="saSidenav">
					<div class="saSidenavSection">
						<div class="saCustomerLogo">
							<div>
								<img src="./src/img/logo.svg" style="height: 80px;">
							</div>
						</div>
						<div class="saSidenavContainer">
							<div>
								<a class="saSidenavItemWrapper saSearch saHideWhenExpanded" tabindex="0">
									<div class="saSidenavItem">
										<i class="far fa-magnifying-glass saIcon"></i>
									</div>
								</a>
								<div class="saSidenavItemWrapper saSearch saHideWhenMinimized">
									<div class="saSidenavItem saInputTextWrapper">
										<input id="MenuEnterpriseSearchBox" class="saSearchInput saInputText"
											type="search" placeholder="Sök...">
										<i class="far fa-magnifying-glass saIcon"></i>
									</div>
								</div>
							</div>
							<div class="saSidenavItem saMenuDropdownsOuter">
								<div class="saSidenavItemWrapper">
									<label class="saInputTextWrapper saLabeled">
										<span class="saLabeledLabel">User</span>
										<span class="saFirstLetter">J</span>
										<select class="saInputText saDropdown">
											<option value="1" selected="true">Jonathan</option>
											<option value="2">Ellioth</option>
											<option value="2">Pontus</option>
										</select>
										<div class="saTrailingIconsWrapper">
											<i class="saIcon far fa-angle-down"></i>
										</div>
									</label>
								</div>
							</div>
							<div class="saToggleWrapper">
								<div class="saHandle">
									<div class="saTrack">
										<a class="saToggleIconText saDynamicTooltipJs saActive" tabindex="0"
											data-sa-menutabid="1">
											<i class="far fa-bars icon saIcon"></i>
											<span class="saToggleText">Meny</span>
										</a>
										<a class="saToggleIconText saDynamicTooltipJs" tabindex="0">
											<i class="far fa-star icon saIcon"></i>
											<span class="saToggleText">Favoriter</span>
										</a>
									</div>
								</div>
							</div>
						</div>
						<div class="saSidenavLists">
							<ul class="saSidenavItemList">
								<li>
									<a class="saSidenavItemWrapper" tabindex="0">
										<div class="saSidenavItem">
											<i class="far fa-house-window icon saIcon"></i>
											<span class="saSidenavItemText">Home</span>
										</div>
									</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="saSidenavSection saSidenavSectionLast">
						<div class="saSidenavContainer">
							<div class="saListItem">
								<button class="saSidenavItemWrapper" aria-expanded="false">
									<div class="saSidenavItem saAvatarWrapperOuter">
										<img src="./src/img/avatar2.png" class="saAvatarWrapper">
										<span class="saSidenavItemText">Jonathan Kevin</span>
										<i class="far fa-angle-down saIcon"></i>
									</div>
								</button>
							</div>
							<div class="saSidenavItem saSidenavItemRow">
								<button class="saSidenavItemWrapper">
									<div class="saSidenavItem">
										<i class="fa-window-restore far icon saIcon"></i>
									</div>
								</button>
								<button class="saSidenavItemWrapper">
									<div class="saSidenavItem">
										<i class="fa-cog far icon saIcon"></i>
									</div>
								</button>
								<button class="saSidenavItemWrapper">
									<div class="saSidenavItem">
										<i class="fa-sun-alt far icon saIcon"></i>
									</div>
								</button>
								<button class="saSidenavItemWrapper saNotificationLinkLargeScreen"
									aria-label="2 Notifieringar" aria-live="polite" data-tooltip="Notifieringar">
									<div class="saSidenavItem">
										<div>
											<i class="far fa-bell saIcon"></i>
										</div>
										<span class="saSidenavItemText">Notifieringar</span>
									</div>
									<div class="saNotificationBadge">
										<div class="saNotificationBadgeCount">2</div>
									</div>
								</button>
							</div>
						</div>
						<div class="saSidenavFooter">
							<a class="saSoftadminLogo" target="_blank" rel="noopener noreferrer" tabindex="-1"
								href="https://www.multisoft.se/softadmin/">
								<span class="saLogo"></span>
								<span class="saWordmark">
									<div class="saSweep">
										<div class="saSweepText">
											<span>SOFTADMIN</span> <span class="saSweepR">®</span>
											<span class="saSweep8">8</span>
										</div>
										<div class="saSweepEffect">
											<div> <span>SOFTADMIN</span> <span class="saSweepR">®</span> <span
													class="saSweep8">8</span> </div>
											<div> <span>SOFTADMIN</span> <span class="saSweepR">®</span> <span
													class="saSweep8">8</span> </div>
											<div> <span>SOFTADMIN</span> <span class="saSweepR">®</span> <span
													class="saSweep8">8</span> </div>
										</div>
									</div>
								</span>
							</a>
							<button class="saExpander saDynamicTooltipJs">
								<i class="fa-angles-left far saIcon"></i>
							</button>
						</div>
					</div>
				</div>
			</nav>
		</div>
		<div class="saRightFrameRoot">
			<div class="right standardview saLargeScreen saPc saCompact saHasTopButtons">
				<form class="interface">
					<header id="pageheader" class="saPageHeaderHolder">
						<div class="saDesktopHeader saPageHeader">
							<div class="saHeader">
								<div class="saRowWrapper">
									<div class="saTopRow">
										<nav class="saBreadcrumbs" aria-label="Brödsmulor">
											<div class="saBackButtonWrapper">
												<button class="saBackButton"><i
														class="fa-arrow-left far saBack saIcon"></i></button>
											</div>
											<span class="saBreadcrumb">
												<a tabindex="0">
													First link
												</a>
											</span>
											<span class="saBreadcrumbSeparator">&gt;</span>
											<span class="saBreadcrumb">
												<a tabindex="0">
													Second link
												</a>
											</span>
										</nav>
									</div>
									<div class="saBottomRow">
										<div class="saTitle">
											<h1 class="saHeaderText">
												Title
											</h1>
										</div>
									</div>
									<nav class="saNavigationBar">
										<div class="saTopButtons">
											<div class="saActionLinks">
												<button class="saTopLink saActionLink saButtonPrimary">
													<div class="saIconHolder">
														<i class="far fa-crow saIcon"></i>
													</div>
													<span class="saButtonText">Crow button</span>
												</button>
												<button class="saTopLink saActionLink saButtonSecondary">
													<div class="saIconHolder">
														<i class="far fa-egg saIcon"></i>
													</div>
													<span class="saButtonText">Egg button</span>
												</button>
												<div class="saCollectorWrapper">
													<button class="saMoreButton">
														<i class="far fa-ellipsis-vertical icon saIcon"></i>
													</button>
												</div>
											</div>
										</div>
									</nav>
								</div>
							</div>
						</div>
						<div class="saPageHeader saSmallScreenHeader">
							<div class="saHeader">
								<div class="saHeaderInner">
									<div class="saTopRow">
										<button class="saBackButton" data-tooltip="Stäng: Visa underhållspunkt"
											aria-label="Stäng: Visa underhållspunkt"><i
												class="fa-arrow-left far saBack saIcon"></i>
										</button>
										<div class="saHeaderWrapper">
											<div class="saTitle">
												<h1 class="saHeaderText">Title</h1>
											</div>
										</div>
										<button class="saNavigator">
											<div class="saNavBar">
												<span class="saNavBarStripe"></span>
												<span class="saNavBarStripe"></span>
												<span class="saNavBarStripe"></span>
											</div>
										</button>
										<button class="saNotificationWrapper">
											<div><i class="far fa-bell saIcon"></i></div>
											<div class="saNotificationBadge">
												<div class="saNotificationBadgeCount">2</div>
											</div>
										</button>
									</div>
								</div>
								<nav class="saBottomRow saActionLinkBar">
									<div class="saTopButtons saActionLinks">
										<button class="saTopLink saActionLink saButtonPrimary">
											<div class="saIconHolder">
												<i class="far fa-crow saIcon"></i>
											</div>
											<span class="saButtonText">Crow button</span>
										</button>
										<button class="saTopLink saActionLink saButtonSecondary">
											<div class="saIconHolder">
												<i class="far fa-egg saIcon"></i>
											</div>
											<span class="saButtonText">Egg button</span>
										</button>
										<div class="saCollectorWrapper">
											<button class="saMoreButton">
												<i class="far fa-ellipsis-vertical icon saIcon"></i>
											</button>
										</div>
									</div>
								</nav>
							</div>
						</div>
					</header>

					<div class="maincolinner gradients">
						<main class="menuitem pagecontentframe">
							<div class="scrollindicator" style="display: none;" hidden></div>
							<div class="scrollcontent saScrollable">
								<div class="scrollcontent-inner">
									<div class="saLightboxGroup">
										<lightbox-image dialog-id="lightbox">
											<img src='https://images.unsplash.com/photo-1591703291603-2150887a3db5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3Mzg4MDIyNDd8&ixlib=rb-4.0.3&q=80&w=600'
												alt=''>
										</lightbox-image>

										<lightbox-image dialog-id="lightbox">
											<img src='https://images.unsplash.com/photo-1543466835-00a7907e9de1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3Mzg2ODA2OTh8&ixlib=rb-4.0.3&q=80&w=600'
												alt=''>
										</lightbox-image>

										<lightbox-image dialog-id="lightbox">
											<img src='https://images.unsplash.com/photo-1600352774373-7b992e5189de?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3Mzg2ODU5Njh8&ixlib=rb-4.0.3&q=80&w=600'
												alt=''>
										</lightbox-image>

										<lightbox-image dialog-id="lightbox">
											<img src='https://images.unsplash.com/photo-1615233500147-5b196365bf3e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3Mzg4MDIxNDZ8&ixlib=rb-4.0.3&q=80&w=600'
												alt=''>
										</lightbox-image>

										<lightbox-image dialog-id="lightbox">
											<img src='https://images.unsplash.com/photo-1583511655802-41f2ccc2cc8f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzkwMjc3Mjh8&ixlib=rb-4.0.3&q=80&w=600'
												alt=''>
										</lightbox-image>

										<lightbox-image dialog-id="lightbox">
											<img src='https://images.unsplash.com/photo-1596797882948-7d215d2d169e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MzkwMjc3Mjh8&ixlib=rb-4.0.3&q=80&w=600'
												alt=''>
										</lightbox-image>
									</div>

									<dialog id="lightbox">
										<form method="dialog">
											<button>Close lightbox</button>
										</form>
									</dialog>
								</div>
							</div>
						</main>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script>

		// Use modern JavaScript without jQuery dependency
		document.addEventListener('DOMContentLoaded', () => {
			class LightBoxImage extends HTMLElement {
				get dialog() {
					const attr = this.getAttribute("dialog-id");
					return document.getElementById(attr);
				}

				constructor() {
					super();
					this.attachShadow({ mode: "open" });
					this._isZoomed = false;
				}

				connectedCallback() {
					this.image = this.querySelector("img");

					if (!this.image) {
						console.error("Lightbox requires an img element");
						return;
					}

					// Save original alt text
					this._originalAlt = this.image.alt;

					this.shadowRoot.innerHTML = this.setupToggle();
					this.toggle = this.shadowRoot.querySelector("button");

					// Set up event listeners
					this.addEventListeners();

					// Set up dialog if it exists
					if (this.dialog) {
						this.setupDialog();
					} else {
						console.error(`Dialog with ID "${this.getAttribute("dialog-id")}" not found`);
					}
				}

				disconnectedCallback() {
					this.removeEventListeners();
				}

				setupToggle() {
					return `
        <style>
          button {
            all: unset;
            outline: revert;
            display: grid;
            grid-template-areas: "box";
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
          }

          button:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          }

          button:focus-visible {
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.6);
          }

          button > * {
            grid-area: box;
          }

          img {
            max-width: 100%;
            height: auto;
            visibility: hidden;
          }

          .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
          }

          @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
          }
        </style>
        <button aria-label="Open image in lightbox" aria-expanded="false">
          ${this.image.outerHTML}
          <div class="loading-indicator"></div>
          <div>
            <slot></slot>
          </div>
        </button>
      `;
				}

				setupDialog() {
					// Add styles to dialog
					const style = document.createElement('style');
					style.textContent = `
        #${this.dialog.id} {
          padding: 0;
          border: none;
          background: rgba(0, 0, 0, 0.9);
          max-width: 100vw;
          max-height: 100vh;
          width: 100vw;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        #${this.dialog.id}::backdrop {
          background: rgba(0, 0, 0, 0.8);
        }

        #${this.dialog.id} img {
          max-width: 90vw;
          max-height: 90vh;
          object-fit: contain;
          transition: transform 0.3s ease;
          cursor: zoom-in;
        }

        #${this.dialog.id} img.zoomed {
          transform: scale(1.5);
          cursor: zoom-out;
        }

        #${this.dialog.id} .close-button {
          position: absolute;
          top: 20px;
          right: 20px;
          background: rgba(255, 255, 255, 0.3);
          border: none;
          color: white;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          font-size: 20px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background 0.2s ease;
        }

        #${this.dialog.id} .close-button:hover {
          background: rgba(255, 255, 255, 0.5);
        }
      `;

					// Add close button to dialog
					const closeButton = document.createElement('button');
					closeButton.classList.add('close-button');
					closeButton.innerHTML = '✕';
					closeButton.setAttribute('aria-label', 'Close lightbox');

					this.dialog.appendChild(style);
					this.dialog.appendChild(closeButton);

					// Set dialog attributes for accessibility
					this.dialog.setAttribute('aria-modal', 'true');
					this.dialog.setAttribute('aria-labelledby', `${this.dialog.id}-title`);

					// Add hidden title for screen readers
					const title = document.createElement('h2');
					title.id = `${this.dialog.id}-title`;
					title.textContent = `Image: ${this._originalAlt || 'Lightbox image'}`;
					title.style.position = 'absolute';
					title.style.clip = 'rect(0 0 0 0)';
					title.style.clipPath = 'inset(50%)';
					title.style.height = '1px';
					title.style.overflow = 'hidden';
					title.style.whiteSpace = 'nowrap';
					title.style.width = '1px';

					this.dialog.prepend(title);

					// Add event listeners for dialog
					closeButton.addEventListener('click', () => this.closeDialog());
				}

				addEventListeners() {
					this.toggle.addEventListener("click", this.handleToggleClick.bind(this));

					if (this.dialog) {
						this.dialog.addEventListener("click", this.handleDialogClick.bind(this));
						this.dialog.addEventListener("cancel", this.handleDialogCancel.bind(this));
						document.addEventListener("keydown", this.handleKeyDown.bind(this));

						// Touch events for mobile swipe
						this.dialog.addEventListener("touchstart", this.handleTouchStart.bind(this));
						this.dialog.addEventListener("touchmove", this.handleTouchMove.bind(this));
						this.dialog.addEventListener("touchend", this.handleTouchEnd.bind(this));
					}
				}

				removeEventListeners() {
					this.toggle.removeEventListener("click", this.handleToggleClick.bind(this));

					if (this.dialog) {
						this.dialog.removeEventListener("click", this.handleDialogClick.bind(this));
						this.dialog.removeEventListener("cancel", this.handleDialogCancel.bind(this));
						document.removeEventListener("keydown", this.handleKeyDown.bind(this));

						this.dialog.removeEventListener("touchstart", this.handleTouchStart.bind(this));
						this.dialog.removeEventListener("touchmove", this.handleTouchMove.bind(this));
						this.dialog.removeEventListener("touchend", this.handleTouchEnd.bind(this));
					}
				}

				handleToggleClick() {
					this.showLoadingIndicator();
					this.toggle.setAttribute('aria-expanded', 'true');
					this.moveImage(() => this.moveImageToTarget());
				}

				handleDialogClick(e) {
					// Only close if clicked on the backdrop, not the image
					if (e.target === this.dialog) {
						this.closeDialog();
					} else if (e.target.tagName === 'IMG') {
						this.toggleZoom(e.target);
					}
				}

				toggleZoom(imgElement) {
					this._isZoomed = !this._isZoomed;
					if (this._isZoomed) {
						imgElement.classList.add('zoomed');
						imgElement.style.cursor = 'zoom-out';
					} else {
						imgElement.classList.remove('zoomed');
						imgElement.style.cursor = 'zoom-in';
					}
				}

				handleDialogCancel(e) {
					if (this.dialog.contains(this.image)) {
						e.preventDefault();
						this.closeDialog();
					}
				}

				closeDialog() {
					this._isZoomed = false;
					this.toggle.setAttribute('aria-expanded', 'false');
					this.moveImage(() => this.moveImageBack());
				}

				handleKeyDown(e) {
					if (this.dialog.open) {
						// Close on ESC key
						if (e.key === 'Escape') {
							e.preventDefault();
							this.closeDialog();
						}

						// Toggle zoom on spacebar
						if (e.key === ' ' && this.dialog.contains(this.image)) {
							e.preventDefault();
							this.toggleZoom(this.image);
						}
					}
				}

				// Touch handling for mobile
				handleTouchStart(e) {
					this._touchStartX = e.touches[0].clientX;
					this._touchStartY = e.touches[0].clientY;
				}

				handleTouchMove(e) {
					if (!this._touchStartX || !this._touchStartY) return;

					const xDiff = this._touchStartX - e.touches[0].clientX;
					const yDiff = this._touchStartY - e.touches[0].clientY;

					// Prevent default only if swiping significantly down (to close)
					if (Math.abs(yDiff) > Math.abs(xDiff) && yDiff < -50) {
						e.preventDefault();
					}
				}

				handleTouchEnd(e) {
					if (!this._touchStartX || !this._touchStartY) return;

					const xDiff = this._touchStartX - e.changedTouches[0].clientX;
					const yDiff = this._touchStartY - e.changedTouches[0].clientY;

					// Close dialog on significant downward swipe
					if (Math.abs(yDiff) > Math.abs(xDiff) && yDiff < -100) {
						this.closeDialog();
					}

					// Reset values
					this._touchStartX = null;
					this._touchStartY = null;
				}

				showLoadingIndicator() {
					const indicator = this.shadowRoot.querySelector('.loading-indicator');
					if (indicator) {
						indicator.style.opacity = '1';
					}
				}

				hideLoadingIndicator() {
					const indicator = this.shadowRoot.querySelector('.loading-indicator');
					if (indicator) {
						indicator.style.opacity = '0';
					}
				}

				moveImage(fn) {
					if (!document.startViewTransition) {
						fn();
						this.hideLoadingIndicator();
						this.applyFallbackAnimation();
					} else {
						this.handleViewTransition(fn);
					}
				}

				async handleViewTransition(fn) {
					this.image.style.viewTransitionName = "active-lightbox-image";

					try {
						const transition = document.startViewTransition(() => {
							fn();
							return new Promise(resolve => {
								// Allow time for the DOM to update
								requestAnimationFrame(() => {
									requestAnimationFrame(resolve);
								});
							});
						});

						await transition.finished;
					} catch (error) {
						console.error("View transition failed:", error);
						// Apply fallback if view transition fails
						fn();
						this.applyFallbackAnimation();
					} finally {
						this.image.style.removeProperty("view-transition-name");
						this.hideLoadingIndicator();
					}
				}

				applyFallbackAnimation() {
					// Apply CSS animations for browsers without View Transitions API
					if (this.dialog.contains(this.image)) {
						// Opening animation
						this.image.animate([
							{ opacity: 0, transform: 'scale(0.9)' },
							{ opacity: 1, transform: 'scale(1)' }
						], {
							duration: 300,
							easing: 'ease-out'
						});
					} else {
						// Closing animation
						this.image.animate([
							{ opacity: 0.8 },
							{ opacity: 1 }
						], {
							duration: 200,
							easing: 'ease-out'
						});
					}
				}

				moveImageToTarget() {
					// Update alt text for the lightbox context
					this.image.setAttribute('alt', this._originalAlt || '');
					this.dialog.append(this.image);
					this.dialog.showModal();
				}

				moveImageBack() {
					this.append(this.image);
					this.dialog.close();

					// Reset zoom state
					this.image.classList.remove('zoomed');
				}
			}

			customElements.define("lightbox-image", LightBoxImage);
		});
	</script>
</body>

</html>