<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lightbox</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="./src/fontawesome/css/all.css">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
</head>

<body>
	<div class="saRootContentWrapper">
		<div class="saSideBar saSideBarJs saExpanded">
			<nav id="SideBar">
				<div class="saSidenav">
					<div class="saSidenavSection">
						<div class="saCustomerLogo">
							<div>
								<img src="./src/img/logo.svg" style="height: 80px;">
							</div>
						</div>
						<div class="saSidenavContainer">
							<div>
								<a class="saSidenavItemWrapper saSearch saHideWhenExpanded" tabindex="0">
									<div class="saSidenavItem">
										<i class="far fa-magnifying-glass saIcon"></i>
									</div>
								</a>
								<div class="saSidenavItemWrapper saSearch saHideWhenMinimized">
									<div class="saSidenavItem saInputTextWrapper">
										<input id="MenuEnterpriseSearchBox" class="saSearchInput saInputText"
											type="search" placeholder="Sök...">
										<i class="far fa-magnifying-glass saIcon"></i>
									</div>
								</div>
							</div>
							<div class="saSidenavItem saMenuDropdownsOuter">
								<div class="saSidenavItemWrapper">
									<label class="saInputTextWrapper saLabeled">
										<span class="saLabeledLabel">User</span>
										<span class="saFirstLetter">J</span>
										<select class="saInputText saDropdown">
											<option value="1" selected="true">Jonathan</option>
											<option value="2">Ellioth</option>
											<option value="2">Pontus</option>
										</select>
										<div class="saTrailingIconsWrapper">
											<i class="saIcon far fa-angle-down"></i>
										</div>
									</label>
								</div>
							</div>
							<div class="saToggleWrapper">
								<div class="saHandle">
									<div class="saTrack">
										<a class="saToggleIconText saDynamicTooltipJs saActive" tabindex="0"
											data-sa-menutabid="1">
											<i class="far fa-bars icon saIcon"></i>
											<span class="saToggleText">Meny</span>
										</a>
										<a class="saToggleIconText saDynamicTooltipJs" tabindex="0">
											<i class="far fa-star icon saIcon"></i>
											<span class="saToggleText">Favoriter</span>
										</a>
									</div>
								</div>
							</div>
						</div>
						<div class="saSidenavLists">
							<ul class="saSidenavItemList">
								<li>
									<a class="saSidenavItemWrapper" tabindex="0">
										<div class="saSidenavItem">
											<i class="far fa-house-window icon saIcon"></i>
											<span class="saSidenavItemText">Home</span>
										</div>
									</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="saSidenavSection saSidenavSectionLast">
						<div class="saSidenavContainer">
							<div class="saListItem">
								<button class="saSidenavItemWrapper" aria-expanded="false">
									<div class="saSidenavItem saAvatarWrapperOuter">
										<img src="./src/img/avatar2.png" class="saAvatarWrapper">
										<span class="saSidenavItemText">Jonathan Kevin</span>
										<i class="far fa-angle-down saIcon"></i>
									</div>
								</button>
							</div>
							<div class="saSidenavItem saSidenavItemRow">
								<button class="saSidenavItemWrapper">
									<div class="saSidenavItem">
										<i class="fa-window-restore far icon saIcon"></i>
									</div>
								</button>
								<button class="saSidenavItemWrapper">
									<div class="saSidenavItem">
										<i class="fa-cog far icon saIcon"></i>
									</div>
								</button>
								<button class="saSidenavItemWrapper">
									<div class="saSidenavItem">
										<i class="fa-sun-alt far icon saIcon"></i>
									</div>
								</button>
								<button class="saSidenavItemWrapper saNotificationLinkLargeScreen"
									aria-label="2 Notifieringar" aria-live="polite" data-tooltip="Notifieringar">
									<div class="saSidenavItem">
										<div>
											<i class="far fa-bell saIcon"></i>
										</div>
										<span class="saSidenavItemText">Notifieringar</span>
									</div>
									<div class="saNotificationBadge">
										<div class="saNotificationBadgeCount">2</div>
									</div>
								</button>
							</div>
						</div>
						<div class="saSidenavFooter">
							<a class="saSoftadminLogo" target="_blank" rel="noopener noreferrer" tabindex="-1"
								href="https://www.multisoft.se/softadmin/">
								<span class="saLogo"></span>
								<span class="saWordmark">
									<div class="saSweep">
										<div class="saSweepText">
											<span>SOFTADMIN</span> <span class="saSweepR">®</span>
											<span class="saSweep8">8</span>
										</div>
										<div class="saSweepEffect">
											<div> <span>SOFTADMIN</span> <span class="saSweepR">®</span> <span
													class="saSweep8">8</span> </div>
											<div> <span>SOFTADMIN</span> <span class="saSweepR">®</span> <span
													class="saSweep8">8</span> </div>
											<div> <span>SOFTADMIN</span> <span class="saSweepR">®</span> <span
													class="saSweep8">8</span> </div>
										</div>
									</div>
								</span>
							</a>
							<button class="saExpander saDynamicTooltipJs">
								<i class="fa-angles-left far saIcon"></i>
							</button>
						</div>
					</div>
				</div>
			</nav>
		</div>
		<div class="saRightFrameRoot">
			<div class="right standardview saLargeScreen saPc saCompact saHasTopButtons">
				<form class="interface">
					<header id="pageheader" class="saPageHeaderHolder">
						<div class="saDesktopHeader saPageHeader">
							<div class="saHeader">
								<div class="saRowWrapper">
									<div class="saTopRow">
										<nav class="saBreadcrumbs" aria-label="Brödsmulor">
											<div class="saBackButtonWrapper">
												<button class="saBackButton"><i
														class="fa-arrow-left far saBack saIcon"></i></button>
											</div>
											<span class="saBreadcrumb">
												<a tabindex="0">
													First link
												</a>
											</span>
											<span class="saBreadcrumbSeparator">&gt;</span>
											<span class="saBreadcrumb">
												<a tabindex="0">
													Second link
												</a>
											</span>
										</nav>
									</div>
									<div class="saBottomRow">
										<div class="saTitle">
											<h1 class="saHeaderText">
												Title
											</h1>
										</div>
									</div>
									<nav class="saNavigationBar">
										<div class="saTopButtons">
											<div class="saActionLinks">
												<button class="saTopLink saActionLink saButtonPrimary">
													<div class="saIconHolder">
														<i class="far fa-crow saIcon"></i>
													</div>
													<span class="saButtonText">Crow button</span>
												</button>
												<button class="saTopLink saActionLink saButtonSecondary">
													<div class="saIconHolder">
														<i class="far fa-egg saIcon"></i>
													</div>
													<span class="saButtonText">Egg button</span>
												</button>
												<div class="saCollectorWrapper">
													<button class="saMoreButton">
														<i class="far fa-ellipsis-vertical icon saIcon"></i>
													</button>
												</div>
											</div>
										</div>
									</nav>
								</div>
							</div>
						</div>
						<div class="saPageHeader saSmallScreenHeader">
							<div class="saHeader">
								<div class="saHeaderInner">
									<div class="saTopRow">
										<button class="saBackButton" data-tooltip="Stäng: Visa underhållspunkt"
											aria-label="Stäng: Visa underhållspunkt"><i
												class="fa-arrow-left far saBack saIcon"></i>
										</button>
										<div class="saHeaderWrapper">
											<div class="saTitle">
												<h1 class="saHeaderText">Title</h1>
											</div>
										</div>
										<button class="saNavigator">
											<div class="saNavBar">
												<span class="saNavBarStripe"></span>
												<span class="saNavBarStripe"></span>
												<span class="saNavBarStripe"></span>
											</div>
										</button>
										<button class="saNotificationWrapper">
											<div><i class="far fa-bell saIcon"></i></div>
											<div class="saNotificationBadge">
												<div class="saNotificationBadgeCount">2</div>
											</div>
										</button>
									</div>
								</div>
								<nav class="saBottomRow saActionLinkBar">
									<div class="saTopButtons saActionLinks">
										<button class="saTopLink saActionLink saButtonPrimary">
											<div class="saIconHolder">
												<i class="far fa-crow saIcon"></i>
											</div>
											<span class="saButtonText">Crow button</span>
										</button>
										<button class="saTopLink saActionLink saButtonSecondary">
											<div class="saIconHolder">
												<i class="far fa-egg saIcon"></i>
											</div>
											<span class="saButtonText">Egg button</span>
										</button>
										<div class="saCollectorWrapper">
											<button class="saMoreButton">
												<i class="far fa-ellipsis-vertical icon saIcon"></i>
											</button>
										</div>
									</div>
								</nav>
							</div>
						</div>
					</header>

					<div class="maincolinner gradients">
						<main class="menuitem pagecontentframe">
							<div class="scrollindicator" style="display: none;" hidden></div>
							<div class="scrollcontent saScrollable">
								<div class="scrollcontent-inner">
									<style>
										.gallery {
											display: grid;
											grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
											gap: 16px;
											padding: 20px;
										}

										.gallery-item {
											overflow: hidden;
											border-radius: 4px;
										}

										.gallery-item img {
											width: 100%;
											height: 200px;
											object-fit: cover;
											transition: transform 0.3s ease;
										}

										.gallery-item img:hover {
											transform: scale(1.05);
										}
									</style>
									<div class="gallery">
										<a href="https://picsum.photos/id/237/800/600" class="gallery-item">
											<img src="https://picsum.photos/id/237/200/200" alt="Gallery Image">
										</a>
										<a href="https://picsum.photos/id/238/800/600" class="gallery-item">
											<img src="https://picsum.photos/id/238/200/200" alt="Gallery Image">
										</a>
										<a href="https://picsum.photos/id/239/800/600" class="gallery-item">
											<img src="https://picsum.photos/id/239/200/200" alt="Gallery Image">
										</a>
									</div>

									<script>
										$(document).ready(function () {
											$('.gallery-item').transitionLightbox({
												overlayColor: 'rgba(0, 0, 0, 0.95)',
												onOpen: function () {
													console.log('Lightbox opened');
												}
											});
											/**
 * jQuery Lightbox with View Transition API using Dialog
 * A lightweight lightbox component that uses the native View Transition API
 * for smooth animations and the <dialog> element for better accessibility.
 */

											(function ($) {
												// Check if View Transition API is supported
												const isViewTransitionSupported = 'startViewTransition' in document;

												// Lightbox plugin
												$.fn.transitionLightbox = function (options) {
													// Default settings
													const settings = $.extend({
														overlayColor: 'rgba(0, 0, 0, 0.9)',
														transitionDuration: '0.5s',
														closeOnEscape: true,
														closeOnOverlayClick: true,
														onOpen: function () { },
														onClose: function () { }
													}, options);

													// Add required CSS
													const lightboxStyles = `
      dialog.tl-dialog {
        padding: 0;
        border: none;
        background: transparent;
        max-width: 90vw;
        max-height: 90vh;
        overflow: visible;
      }

      dialog.tl-dialog::backdrop {
        background-color: ${settings.overlayColor};
        transition: opacity ${settings.transitionDuration} ease;
      }

      .tl-content {
        position: relative;
        view-transition-name: lightbox-content;
        background: white;
        border-radius: 4px;
        overflow: hidden;
        max-width: 100%;
        max-height: 100%;
      }

      .tl-close {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 30px;
        cursor: pointer;
        z-index: 10001;
        font-family: Arial, sans-serif;
        border: none;
      }

      .tl-image {
        max-width: 100%;
        max-height: 80vh;
        display: block;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes scaleIn {
        from { transform: scale(0.9); }
        to { transform: scale(1); }
      }

      /* View Transition Styles */
      @media (prefers-reduced-motion: no-preference) {
        ::view-transition-old(lightbox-content) {
          animation: 0.5s cubic-bezier(0.4, 0, 0.2, 1) both fadeOut;
        }

        ::view-transition-new(lightbox-content) {
          animation: 0.5s cubic-bezier(0.4, 0, 0.2, 1) both fadeIn,
                     0.5s cubic-bezier(0.4, 0, 0.2, 1) both scaleIn;
        }
      }

      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }
    `;

													$('<style>').text(lightboxStyles).appendTo('head');

													// Create dialog element if it doesn't exist
													if ($('dialog.tl-dialog').length === 0) {
														$('body').append('<dialog class="tl-dialog"><div class="tl-content"></div></dialog>');
														$('.tl-content').append('<button class="tl-close" aria-label="Close lightbox">×</button>');
													}

													const $dialog = $('dialog.tl-dialog');
													const $content = $('.tl-content');
													const $close = $('.tl-close');

													// Make dialog a modal dialog
													const dialogElement = $dialog[0];

													// Close lightbox function
													const closeLightbox = function () {
														if (isViewTransitionSupported) {
															document.startViewTransition(() => {
																dialogElement.close();
																setTimeout(() => {
																	$content.empty().append($close);
																}, parseFloat(settings.transitionDuration) * 1000);
																settings.onClose();
															});
														} else {
															dialogElement.close();
															setTimeout(() => {
																$content.empty().append($close);
															}, parseFloat(settings.transitionDuration) * 1000);
															settings.onClose();
														}
													};

													// Event handlers for closing
													$close.on('click', closeLightbox);

													if (settings.closeOnOverlayClick) {
														$dialog.on('click', function (e) {
															if (e.target === dialogElement) {
																closeLightbox();
															}
														});
													}

													// Native dialog handles Escape key automatically if closeOnEscape is true
													if (!settings.closeOnEscape) {
														$dialog.on('cancel', function (e) {
															e.preventDefault();
														});
													}

													// Initialize lightbox for each element
													return this.each(function () {
														const $this = $(this);

														$this.css('view-transition-name', 'lightbox-source');
														$this.css('cursor', 'pointer');

														$this.on('click', function (e) {
															e.preventDefault();

															const contentType = $this.data('type') || 'image';
															let content;

															// Handle different content types
															if (contentType === 'image') {
																const src = $this.attr('href') || $this.data('src') || $this.attr('src');
																content = `<img src="${src}" class="tl-image" alt="Lightbox Image">`;
															} else if (contentType === 'html') {
																const target = $this.data('target');
																content = $(target).html();
															} else if (contentType === 'iframe') {
																const src = $this.attr('href') || $this.data('src');
																content = `<iframe src="${src}" style="width: 80vw; height: 80vh; border: none;"></iframe>`;
															}

															// Open lightbox with transition
															if (isViewTransitionSupported) {
																document.startViewTransition(() => {
																	$content.append(content);
																	dialogElement.showModal();
																	settings.onOpen();
																});
															} else {
																$content.append(content);
																dialogElement.showModal();
																settings.onOpen();
															}

															// Set focus to close button for better accessibility
															$close.focus();
														});
													});
												};
											})(jQuery);
										});

									</script>

								</div>
							</div>
						</main>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script>

		$(document).ready(function () {
			class LightboxImage extends HTMLElement {
				get dialog() {
					const attr = this.getAttribute("data-dialog-id");
					return document.getElementById(attr);
				}

				constructor() {
					super();
					this.attachShadow({ mode: "open" });
				}

				connectedCallback() {
					this.image = $(this).find("img")[0];
					this.shadowRoot.innerHTML = this.addButton();
					this.toggle = $(this.shadowRoot).find("button")[0];

					// Use jQuery event handlers
					$(this.toggle).on("click", (e) => this.onclick(e));
					$(this.dialog).on("click", (e) => this.onclick(e));
					$(this.dialog).on("cancel", (e) => this.oncancel(e));

					// Touch events
					const $lightbox = $(this.dialog).find(".saLightbox");
					$lightbox.on('touchstart', (e) => this.ontouchstart(e));
					$lightbox.on('touchmove', (e) => this.ontouchmove(e));
					$lightbox.on('touchend', (e) => this.ontouchend(e));

					// Close button event
					const $closeButton = $(this.dialog).find('.saDialogButtonClose');
					if ($closeButton.length) {
						$closeButton.on("click", (e) => this.onclick(e));
					}
				}

				addButton() {
					return `
            <style>
                button {
                    all: unset;
                    outline: revert;
                    display: grid;
                    grid-template-areas: "box";
                }

                button > * {
                    grid-area: box;
                }

                img {
                    max-width: 100%;
                    height: auto;
                    visibility: hidden;
                }
            </style>

            <button aria-label="Open image in lightbox" type="button" aria-expanded="false">
                ${this.image.outerHTML}
                <div>
                    <slot></slot>
                </div>
            </button>
			`;
				}

				onclick(e) {
					if (e.currentTarget === this.toggle) {
						this.moveImage(() => this.moveImageToTarget());
						this.setDynamicBackgroundColor(this.image);
						this.zoomEnabled(this.image);
					}

					if (e.currentTarget === this.dialog) {
						this.dialogCallback(e);
					}
				}

				oncancel(e) {
					this.dialogCallback(e);
				}

				dialogCallback(e) {
					// If the image is in the dialog and click was outside the image or on close button
					if ($.contains(this.dialog, this.image)) {
						// Check if click was on the background (dialog itself) or close button
						if (e.target === this.dialog || $(e.target).closest('.saDialogButtonClose').length) {
							e.preventDefault();
							this.moveImage(() => this.moveImageBack());
						}

					}
				}

				moveImage(fn) {
					// Preserve native startViewTransition
					if (!document.startViewTransition) {
						fn();
					} else {
						this.handleViewTransition(fn);
					}
				}

				async handleViewTransition(fn) {
					$(this.image).css('viewTransitionName', 'lightbox-image-active');

					// Keep the native startViewTransition
					const transition = document.startViewTransition(() => fn());

					try {
						await transition.finished;
						console.log("Transition finished");
					} finally {
						$(this.image).css('viewTransitionName', '');
					}
				}

				moveImageToTarget() {
					if ($('body').hasClass('saPc')) {
						// Create a button and wrap the image
						const $zoomButton = $('<button>', {
							type: 'button',
							'aria-label': 'Zoom in on this image',
							class: 'saZoomButton'
						});
						$zoomButton.append(this.image);
						$(this.dialog).find('.saLightbox').append($zoomButton);

						// Add event listener for toggling zoom
						$zoomButton.on('click', () => this.toggleZoom());
					} else {
						$(this.dialog).find('.saLightbox').append(this.image);
					}
					this.dialog.showModal();
				}

				moveImageBack() {
					$(this).append(this.image);
					this.dialog.close();
					$(this.dialog).removeClass('saZoomFull saLarger');
					$(this.image).css('backgroundColor', '');
				}

				setDynamicBackgroundColor(img) {
					if (!img.complete) return;

					try {
						const avgColor = this.getAverageColor(img);
						const luminance = this.calculateLuminance(avgColor);
						const backgroundColor = luminance < 128 ? 'white' : 'black';
						$(img).css('backgroundColor', backgroundColor);
					} catch (error) {
						console.warn("Could not analyze image colors - CORS issue:", error);
						$(img).css('backgroundColor', 'black'); // Fallback to black
					}
				}

				getAverageColor(imgElement) {
					const canvas = document.createElement('canvas');
					const context = canvas.getContext('2d');
					canvas.width = imgElement.naturalWidth;
					canvas.height = imgElement.naturalHeight;
					context.drawImage(imgElement, 0, 0, canvas.width, canvas.height);
					const data = context.getImageData(0, 0, canvas.width, canvas.height).data;

					let r = 0, g = 0, b = 0, count = 0;
					for (let i = 0; i < data.length; i += 4) {
						if (data[i + 3] > 0) {
							r += data[i];
							g += data[i + 1];
							b += data[i + 2];
							count++;
						}
					}
					return { r: Math.floor(r / count), g: Math.floor(g / count), b: Math.floor(b / count) };
				}

				calculateLuminance(color) {
					return 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;
				}

				zoomEnabled(img) {
					if (img.naturalWidth >= window.innerWidth ||
						img.naturalHeight >= window.innerHeight) {
						$(this.dialog).addClass('saLarger');
					} else {
						$(this.dialog).removeClass('saLarger');
					}
				}

				toggleZoom() {
					if ($(this.dialog).hasClass('saZoomFull')) {
						$(this.dialog).removeClass('saZoomFull');
						$(this.dialog).find('.saZoomButton').attr('aria-expanded', 'false');
						$(this.dialog).find('.saZoomButton').attr('aria-label', 'Click to increase image size');
					} else {
						$(this.dialog).addClass('saZoomFull');
						$(this.dialog).find('.saZoomButton').attr('aria-expanded', 'true');
						$(this.dialog).find('.saZoomButton').attr('aria-label', 'Click to decrease image size');
					}
				}
			}

			customElements.define("lightbox-image", LightboxImage);
		});
	</script>
</body>

</html>