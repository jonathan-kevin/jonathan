<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Slider</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="../src/fontawesome/css/all.css">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
	<style>
		.saLabel {
			font-size: 14px;
			line-height: 16px;
			font-weight: 500;
		}

		.saDescription {
			font-size: 14px;
			line-height: 16px;
			font-weight: 300;
			color: #506072;
		}
	</style>
</head>

<body>
	<a href="http://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/range">mozilla.org</a>

	<main style="padding: 80px; display: flex; align-items: flex-start; height: fit-content;">
		<form class="daForm">
			<div class="saControl" style="width: 320px;">
				<label id="label-crow">
					<div class="saLabel">Crow count</div>
					<div class="saDescription">If crows were created before start date.</div>
				</label>
				<fieldset class="saSliderWrapper saRange saRangeDual" aria-labelledby="label-crow">
					<div class="saSlider saMin">
						<input type="range" min="0" max="100" value="25" class="saInputSlider" aria-label="Min value" list="crow">
						<input type="number" min="0" max="100" class="saSliderValue saMin" value="25" tabindex="-1" aria-label="Min value">
					</div>
					<div class="saSlider saMax">
						<input type="range" min="0" max="100" value="75" class="saInputSlider" aria-label="Max value" list="crow">
						<input type="number" min="0" max="100" class="saSliderValue saMax" value="75" tabindex="-1" aria-label="Max value">
					</div>
					<datalist class="saDatalist" id="crow">
						<option value="0" label="0"></option>
						<option value="25" label="25"></option>
						<option value="50" label="50"></option>
						<option value="75" label="75"></option>
						<option value="100" label="100"></option>
					</datalist>
				</fieldset>

			</div>
		</form>
	</main>
	<script>
		$(document).ready(function () {

			function updateSlider(value, $slider) {
				const min = $slider.attr('min');
				const max = $slider.attr('max');
				const percentage = ((value - min) * 100) / (max - min);
				const $valueDisplay = $slider.parent().find('.saSliderValue');
				const valueDisplayWidth = $valueDisplay.width();
				$valueDisplay.text(value);
				var thumbWidth = 24;
				if ($('body').hasClass('saSmallScreen')) {
					thumbWidth = 44;
				}
				else {
					thumbWidth = 24;
				}
				const sliderWidth = $slider.outerWidth();
				const leftPosition = (percentage * (sliderWidth - thumbWidth) + thumbWidth / 2 - valueDisplayWidth / 2) / 100;

				$valueDisplay.css({
					'left': leftPosition - 12
				});

				if ($slider.is(':disabled')) {
					$slider.css('background', `linear-gradient(to right, #adbdd1 ${percentage}%, #dde3eC ${percentage}%)`);
				}
				else if ($slider.hasClass('saError')) {
					$slider.css('background', `linear-gradient(to right, #e0163e ${percentage}%, #ffc7c4 ${percentage}%)`);
				}

				else if ($slider.hasClass('saWarning')) {
					$slider.css('background', `linear-gradient(to right, #ffcd71 ${percentage}%, #f6ae02 ${percentage}%)`);
				}

				else {
					$slider.css('background', `linear-gradient(to right, #2d6ce1 ${percentage}%, #dde3eC ${percentage}%)`);
				}

			}

			function positionMarkers($slider) {
				const min = $slider.attr('min');
				const max = $slider.attr('max');
				const $datalist = $slider.parent().parent().parent().find('datalist');
				const $options = $datalist.find('option');
				const sliderWidth = $slider.width();
				const thumbWidth = 24;

				$options.each(function () {
					const $option = $(this);
					const value = $option.val();
					const percentage = ((value - min) * 100) / (max - min);
					const leftPosition = percentage * (sliderWidth - thumbWidth) / 100 + thumbWidth / 2;

					$option.css({
						'left': leftPosition
					});
				});
			}

			$('input.saInputSlider').on('input', function () {
				const $this = $(this);
				const value = $this.val();

				if ($this.hasClass('saSpecial')) {
					const $number = $this.parent().parent().parent().find('input[type="number"]');
					$number.val(value);
					updateSlider(value, $this);
				}

				else {
					const $number = $this.parent().find('input[type="number"]');
					$number.val(value);
					updateSlider(value, $this);
				}

			});

			$('input[type="number"]').on('blur keyup', function (e) {
				const $this = $(this);
				const value = $this.val();

				if ($this.hasClass('saSpecial')) {
					const $slider = $this.parent().parent().parent().find('input.saInputSlider');
					$slider.val(value).trigger('input');
				}

				else if (e.type === 'blur' || (e.type === 'keyup' && e.key === 'Enter') || e.type === 'click') {
					const $slider = $this.parent().find('input.saInputSlider');
					$slider.val(value).trigger('input');
				}
			});

			$('.saRangeStep').on('click', '.saButton', function () {
				let $parent = $(this).closest('.saRangeStep');
				let $input = $parent.find('.saInputText');
				let $slider = $parent.closest('.saRangeStepWrapper').find('.saSlider input');

				let step = parseInt($input.attr('step'));
				let min = parseInt($input.attr('min'));
				let max = parseInt($input.attr('max'));
				let currentValue = parseInt($input.val());

				if ($(this).is('#goMinus') && currentValue > min) {
					// Decrease
					$input.val(currentValue - step);
					$slider.val(currentValue - step);
				}
				else if ($(this).is('#goPlus') && currentValue < max) {
					// Increase
					$input.val(currentValue + step);
					$slider.val(currentValue + step);
				}

				$('input.saInputSlider.saSpecial').trigger('input');
			});

			$('input.saInputSlider').each(function () {
				const $this = $(this);
				updateSlider($this.val(), $this);
				positionMarkers($this);
			});

			$('input.saInputSlider').trigger('input');

			$('.saRangeDual').each(function () {
				var $minSlider = $(this).find('.saMin input.saInputSlider');
				var $maxSlider = $(this).find('.saMax input.saInputSlider');
				var $minValueDisplay = $(this).find('.saSliderValue.saMin');
				var $maxValueDisplay = $(this).find('.saSliderValue.saMax');

				function updateRangeSlider($slider, value, isMin) {
					const min = $slider.attr('min');
					const max = $slider.attr('max');
					const percentage = ((value - min) * 100) / (max - min);
					const $valueDisplay = isMin ? $minValueDisplay : $maxValueDisplay;
					const valueDisplayWidth = $valueDisplay.width();
					$valueDisplay.text(value);

					var thumbWidth = 24;

					if ($('body').hasClass('saSmallScreen')) {
						thumbWidth = 32;
					}
					else {
						thumbWidth = 24;
					}
					const sliderWidth = $slider.width();
					const leftPosition = (percentage * (sliderWidth - thumbWidth) + thumbWidth / 2 - valueDisplayWidth / 2) / 100;

					$valueDisplay.css({
						'left': leftPosition - 12
					});
				}

				function synchronizeSliders() {
					const minValue = parseInt($minSlider.val());
					const maxValue = parseInt($maxSlider.val());
					const min = parseInt($minSlider.attr('min'));
					const max = parseInt($minSlider.attr('max'));

					if (minValue > maxValue - 1) {
						$minSlider.val(maxValue - 1);
						updateRangeSlider($minSlider, maxValue - 1, true);
					} else if (maxValue < minValue + 1) {
						$maxSlider.val(minValue + 1);
						updateRangeSlider($maxSlider, minValue + 1, false);
					}

					const minPercentage = ((minValue - min) * 100) / (max - min);
					const maxPercentage = ((maxValue - min) * 100) / (max - min);

					const gradient = `linear-gradient(to right, #dde3eC ${minPercentage}%, #2d6ce1 ${minPercentage}%, #2d6ce1 ${maxPercentage}%, #dde3eC ${maxPercentage}%)`;
					const gradientDisabled = `linear-gradient(to right, #dde3eC ${minPercentage}%, #adbdd1 ${minPercentage}%, #adbdd1 ${maxPercentage}%, #dde3eC ${maxPercentage}%)`;
					const gradientError = `linear-gradient(to right, #ffc7c4 ${minPercentage}%, #e0163e ${minPercentage}%, #e0163e ${maxPercentage}%, #ffc7c4 ${maxPercentage}%)`;
					const gradientWarning = `linear-gradient(to right, #ffefd3 ${minPercentage}%, #f6ae02 ${minPercentage}%, #f6ae02 ${maxPercentage}%, #ffefd3 ${maxPercentage}%)`;


					$minSlider.css('background', 'transparent');

					if ($maxSlider.is(':disabled')) {
						$maxSlider.css('background', gradientDisabled);
					}

					else if ($maxSlider.hasClass('saError')) {
						$maxSlider.css('background', gradientError);
					}

					else if ($maxSlider.hasClass('saWarning')) {
						$maxSlider.css('background', gradientWarning);
					}

					else {
						$maxSlider.css('background', gradient);
					}

					updateRangeSlider($minSlider, $minSlider.val(), true);
					updateRangeSlider($maxSlider, $maxSlider.val(), false);
				}

				$minSlider.on('input', function () {
					synchronizeSliders();
				});

				$maxSlider.on('input', function () {
					synchronizeSliders();
				});

				synchronizeSliders();
			});

			$(window).resize(function () {
				synchronizeSliders();
			});
		});

	</script>
</body>

</html>