<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Jonathan</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="../src/fontawesome/css/all.css">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
	<script type="text/javascript" src="https://livejs.com/live.js"></script>
	<link rel="icon" type="image/png" size="16x16" href="../src/img/favicon.svg">
</head>

<body class="saRootBody saLargeScreen saPc saCompact">
	<fieldset id="settings1">
		<legend>Settings</legend>
		<label><input name="settings1" id="enable" type="radio" checked>Enabled</label>
		<label><input name="settings1" id="disable" type="radio">Disabled</label>
		<label><input name="settings1" id="error" type="radio">Error</label>
		<label><input name="settings1" id="warning" type="radio">Warning</label>
		<label><input name="settings1" id="hidden" type="radio">Hidden</label>
	</fieldset>
	<script>
		$(function() {
			const $editor = $('#editor');
			const $prompt = $('#prompt');
			const $send = $('#send');
			const $editButtons = $('#editButtons');
			const $error1 = $('#error1');
			const $warning1 = $('#warning1');
			const $error2 = $('#error2');
			const $warning2 = $('#warning2');

			function hideAllValidation() {
				$error1.hide();
				$warning1.hide();
				$error2.hide();
				$warning2.hide();
			}

			hideAllValidation();

			$('input[name="settings1"]').on('change', function() {
				const id = this.id;
				$prompt.removeClass('saError saWarning saHidden').prop('disabled', false)
					.removeAttr('invalid aria-errormessage');
				$editor.removeClass('saError saWarning saHidden').prop('disabled', false)
					.removeAttr('invalid aria-errormessage');
				$send.show();
				$editButtons.show();
				hideAllValidation();

				switch (id) {
					case 'error':
						$prompt.addClass('saError').attr({'invalid': 'true', 'aria-errormessage': 'error1'});
						$editor.addClass('saError').attr({'invalid': 'true', 'aria-errormessage': 'error2'});
						$error1.show();
						$error2.show();
						break;
					case 'warning':
						$prompt.addClass('saWarning');
						$editor.addClass('saWarning');
						$warning1.show();
						$warning2.show();
						break;
					case 'hidden':
						$prompt.addClass('saHidden');
						$editor.addClass('saHidden');
						break;
					case 'disable':
						$prompt.prop('disabled', true);
						$editor.prop('disabled', true);
						$send.hide();
						$editButtons.hide();
						break;
				}
			});

			// Handle cancel and save for .saEdit message
			const $editForm = $('.saChatMessage.saEdit .saChatMessageEdit');
			const $editMessage = $('.saChatMessage.saEdit');
			const $editTextarea = $editForm.find('textarea');
			const $editBody = $editMessage.find('.saChatMessageBody');
			const $saveBtn = $editForm.find('button[type="submit"]');
			const $footer = $editMessage.find('.saChatMessageFooter');

			// Track original value for change detection
			let originalEditValue = $editTextarea.val();

			$editTextarea.on('input', function() {
				const changed = $(this).val() !== originalEditValue;
				$saveBtn.prop('disabled', !changed);
			});

			$editForm.on('reset', function(e) {
				e.preventDefault();
				$editMessage.removeClass('saEdit');
				$editForm.hide();
				$editBody.show();
				$editTextarea.val(originalEditValue);
				$saveBtn.prop('disabled', true);
				$footer.find('.saChatMessageEdited').remove();
			});

			$editForm.on('submit', function(e) {
				e.preventDefault();
				const newText = $editTextarea.val();
				$editBody.html('<p>' + $('<div>').text(newText).html().replace(/\n/g, '</p><p>') + '</p>');
				$editMessage.removeClass('saEdit');
				$editForm.hide();
				$editBody.show();
				originalEditValue = newText;
				$saveBtn.prop('disabled', true);
				if ($footer.find('.saChatMessageEdited').length === 0) {
					$footer.prepend('<span class="saChatMessageEdited">Edited</span>');
				}
			});

			// Trigger edit state when clicking edit button
			$('.saChatMessage .saChatToolbar button[aria-label="Edit message"]').on('click', function(e) {
				e.preventDefault();
				$editMessage.addClass('saEdit');
				$editForm.show();
				$editBody.hide();
				$editTextarea.focus();
				originalEditValue = $editTextarea.val();
				$saveBtn.prop('disabled', true);
			});

			// Save on Enter, newline on Shift+Enter in edit textarea
			$editTextarea.on('keydown', function(e) {
				if (e.key === 'Enter' && !e.shiftKey) {
					e.preventDefault();
					$editForm.submit();
				}
				// Shift+Enter: default behavior (newline)
			});
		});
	</script>
	<div class="saChatWrapper">
		<div class="saChat" id="theChat">
			<ol class="saChatLog" aria-role="log" aria-relevant="additions" id="chatLog" aria-label="The Chat">
				<li role="separator" class="saChatDate"><time datetime="2025-10-08">Yesterday</time></li>
				<li class="saChatMessage">
					<div title="Olivia Rydén" class="saChatAvatar saPink">JM</div>
					<article class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>Wings UP team! As we navigate through our tasks today.</p>
							<p>Wings UP team! As we navigate through our tasks today.</p>
							<p>Wings UP team! As we navigate through our tasks today.</p>
						</div>
						<footer class="saChatMessageFooter">
							<div class="saChatSenderName">Jessica Mås</div>
							<time class="saChatMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">11:01</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar saFloating">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
					</article>
				</li>
				<li class="saChatMessage">
					<div title="Peter Peter Peter" class="saChatAvatar saGreen">PP</div>
					<article class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>Wings UP team! As we navigate through our tasks today.</p>
						</div>
						<footer class="saChatMessageFooter">
							<div class="saChatSenderName">Peter Peter Peter</div>
							<time class="saChatMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">12:01</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar saFloating">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
					</article>
				</li>
				<li role="separator" class="saChatDate"><time datetime="2025-10-08">Tomorrow</time></li>
				<li class="saChatMessage">
					<div title="Olivia Rydén" class="saChatAvatar saPink">JM</div>
					<article class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Repellendus praesentium adipisci, earum voluptate veritatis fugit architecto quasi, rerum voluptatibus aperiam fuga aliquam? Dignissimos, dolor ratione. Libero minima similique doloribus laboriosam. Lorem ipsum dolor sit amet consectetur, adipisicing elit. Veritatis officiis sint autem est molestias sunt quidem optio soluta cum ea, obcaecati, consectetur sapiente nobis laudantium. Quidem quam vitae doloremque mollitia. Lorem ipsum dolor sit amet consectetur adipisicing elit. Nostrum sequi itaque reiciendis cumque. Doloribus tenetur omnis atque voluptatum iusto repellendus tempora quidem non quo quasi dolorum, voluptatibus id, ex nesciunt. Lorem ipsum dolor sit amet consectetur adipisicing elit. Quidem, illum? Esse ipsum distinctio repellendus consectetur itaque necessitatibus, repudiandae fugiat sint excepturi doloremque non dolorum sunt quas hic laborum dicta vero! Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia quas, praesentium et rerum eligendi placeat ex commodi, explicabo temporibus totam, ut omnis quod sit sunt. Veniam molestias blanditiis consequuntur aperiam. Lorem ipsum dolor sit amet consectetur, adipisicing elit. Alias ut aliquam beatae hic voluptatum ullam. Vel vitae nulla enim impedit non ad ea, repellat voluptate reiciendis dolore eligendi, harum provident?</p>
							<p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia, perspiciatis soluta? Non inventore omnis veritatis? Nobis nesciunt aut ab distinctio consectetur. Debitis placeat sequi totam aspernatur officiis quidem sint unde. Lorem ipsum dolor sit amet consectetur adipisicing elit. Sunt rem delectus amet exercitationem molestiae error impedit dolorum cumque eveniet quibusdam, assumenda, quo officiis eum quis suscipit minima! Odio, voluptatum. Explicabo.</p>
							<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Reprehenderit magni exercitationem, rem corrupti odit inventore incidunt eum, nam dolorem debitis perspiciatis nihil quia suscipit praesentium, possimus ipsa repudiandae optio porro.</p>
						</div>
						<footer class="saChatMessageFooter">
							<div class="saChatSenderName">Jessica Mås</div>
							<time class="saChatMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">11:01</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar saFloating">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
					</article>
				</li>
				<li class="saChatMessage saEdit saSender">
					<article class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Deserunt mollitia rerum hic ducimus nulla soluta, reiciendis eveniet omnis quod obcaecati numquam porro ullam reprehenderit atque quis. Doloribus natus sit omnis! Lorem ipsum dolor sit amet consectetur adipisicing elit. Inventore accusamus recusandae itaque corporis nostrum accusantium quia fuga adipisci temporibus laboriosam quas ullam enim tenetur repellat fugit, in perspiciatis sed quos. Lorem ipsum dolor sit amet consectetur adipisicing elit. Perspiciatis sed ratione delectus ipsum! Beatae blanditiis porro voluptas quidem, deserunt illum laboriosam repellat provident dolorem, possimus rem corrupti quo officia repudiandae.</p>
						</div>
						<footer class="saChatMessageFooter">
							<time class="saChatMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:01">11:01</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
					</article>
					<form class="saChatMessageEdit">
						<label for="editor" class="saScreenReaderOnly">Edit text of message you sent on 12 December 2025 at 11:15</label>
						<textarea id="editor">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Deserunt mollitia rerum hic ducimus nulla soluta, reiciendis eveniet omnis quod obcaecati numquam porro ullam reprehenderit atque quis. Doloribus natus sit omnis! Lorem ipsum dolor sit amet consectetur adipisicing elit. Inventore accusamus recusandae itaque corporis nostrum accusantium quia fuga adipisci temporibus laboriosam quas ullam enim tenetur repellat fugit, in perspiciatis sed quos. Lorem ipsum dolor sit amet consectetur adipisicing elit. Perspiciatis sed ratione delectus ipsum! Beatae blanditiis porro voluptas quidem, deserunt illum laboriosam repellat provident dolorem, possimus rem corrupti quo officia repudiandae.</textarea>
						<div class="saValidationMessage saError" id="error2"><i class="saIcon fas fa-octagon-xmark" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Error or warning goes here</div></div>
						<div class="saValidationMessage saWarning" id="warning2"><i class="saIcon fas fa-triangle-exclamation" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Warning goes here</div></div>
						<div class="saChatButtonGroup" id="editButtons">
							<button type="submit" class="saDefaultButtonPrimary" disabled>Save</button>
							<button type="reset" class="saDefaultButtonSecondary">Cancel</button>
						</div>
					</form>
				</li>
				<li role="separator" class="saChatUnread">
					<button type="button" id="scrollToBottom">New message(s)</button>
				</li>
				<li class="saChatMessage saUnread">
					<img loading="lazy" title="Stefan Stefan" class="saChatAvatar" src="https://untitledui.com/images/avatars/olivia-rhye" alt="Avatar of Stefan Stefan">
					<div class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>Ok.</p>
						</div>
						<footer class="saChatMessageFooter">
							<div class="saChatSenderName">Olivia Thye</div>
							<time class="saChatMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 08:11">08:11</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar saFloating">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
					</div>
				</li>
				<li class="saChatMessage saUnread">
					<img loading="lazy" title="Stefan Stefan" class="saChatAvatar" src="https://untitledui.com/images/avatars/loki-bright" alt="Avatar of Stefan Stefan">
					<div class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>I'm Stefan and with unity and determination, there's no limit to what we can achieve!</p>
						</div>
						<footer class="saChatMessageFooter">
							<div class="saChatSenderName">Erik Öster</div>
							<time class="saChatMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 08:11">08:11</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar saFloating">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
					</div>
				</li>
				<li class="saChatMessage saSender">
					<article class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>tomorrow?</p>
						</div>
						<footer class="saChatMessageFooter">
							<time class="saChatMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">11:01</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar saFloating">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
					</article>
				</li>

				<li class="saChatMessage saSender">
					<article class="saChatMessageInner">
						<div class="saChatMessageBody">
							<p>today?</p>
						</div>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
							<li><button type="button" aria-label="More actions"><i class="far fa-ellipsis-vertical saIcon"></i></button></li>
						</ul>
						<div class="saScreenReaderOnly">
							<time datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:01">11:01</time>
						</div>
					</article>
				</li>
				<li class="saChatResponse">
					<article>
						<p>Sure,</p>
						<p>Let's make sure we're on track to resolve it efficiently. Also, it's time we discuss the bird bill of sale. I'll be available for a meeting later today to go over the details. Looking forward to hearing from everyone!</p>
					</article>
					<ul class="saChatToolbar" role="toolbar" aria-label="Message actions">
						<li>
							<button type="button" title="Copy message" aria-label="Copy message">
								<i class="far fa-copy saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Redo" aria-label="Try again">
								<i class="far fa-arrow-rotate-right saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Crow" aria-label="Crow">
								<i class="far fa-crow saIcon"></i>
							</button>
						</li>
					</ul>
				</li>
				<li role="separator" class="saChatDate">
					<time datetime="2025-10-08">Today</time>
				</li>
				<li class="saChatResponse">
					<article>
						<p>Sure,</p>
						<p>Let's make sure we're on track to resolve it efficiently. Also, it's time we discuss the bird bill of sale. I'll be available for a meeting later today to go over the details. Looking forward to hearing from everyone!</p>
					</article>
					<ul class="saChatToolbar" role="toolbar" aria-label="Message actions">
						<li>
							<button type="button" title="Copy message" aria-label="Copy message">
								<i class="far fa-copy saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Redo" aria-label="Try again">
								<i class="far fa-arrow-rotate-right saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Crow" aria-label="Crow">
								<i class="far fa-crow saIcon"></i>
							</button>
						</li>
					</ul>
				</li>
				<li class="saChatLoading" id="loading" role="separator" aria-busy="true">
					<div class="saDot" aria-hidden="true"></div>
					<div class="saDot" aria-hidden="true"></div>
					<div class="saDot" aria-hidden="true"></div>
				</li>
			</ol>
			<button type="button" class="saChatLatest saReached" id="latest" href="#" aria-label="Scroll to latest messages">
				<i class="far fa-arrow-down"></i>
			</button>
		</div>
		<form class="saChatComposer" id="composer">
			<textarea name="message" placeholder="Write your message..." id="prompt" enterkeyhint="send" aria-label="Wrtie your message"></textarea>
			<button type="submit" class="saChatButtonSend" id="send" disabled aria-label="Send prompt" title="Send prompt">
				<i class="fa-arrow-up saIcon far"></i>
			</button>
			<button type="button" class="saChatButtonStop" id="stop"
				aria-label="Stop response" title="Stop prompt"
				style="display: none;">
				<i class="fa-stop saIcon fas"></i>
			</button>
		</form>
		<div class="saValidationMessage saError" id="error1"><i class="saIcon fas fa-octagon-xmark" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Error goes here</div></div>
		<div class="saValidationMessage saWarning" id="warning1"><i class="saIcon fas fa-triangle-exclamation" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Warning goes here</div></div>
		<p class="saChatComposerInstruction">Please check my work. I'm sickly.</p>
	</div>
	<pre style="max-height: 20px;"><code>
html,
body {
	height: 100%;
	width: 100%;
	box-sizing: border-box;
}

body {
	padding: 1.5rem;
	&.saSmallScreen {
		padding: 0;
	}
}

.ScrollbarHover() {
	scrollbar-gutter: stable;

	&::-webkit-scrollbar {
		background-color: transparent;
	}

	&::-webkit-scrollbar-thumb {
		background-color: transparent;
	}

	&:is(:hover, :focus-within) {
		&::-webkit-scrollbar {
			background-color: @ColorGray200;
		}

		&::-webkit-scrollbar-thumb {
			background-color: @ColorGray500;

			&:hover {
				background-color: @ColorGray700;
			}

			&:active {
				background-color: @ColorGray900;
			}
		}
	}
}

.saChatLoading {
	display: flex;
	gap: 0.25rem;
	padding: 0.5rem;
	border-radius: 999rem;
	background-color: @ColorGray150;
	width: fit-content;
	cursor: wait;
	margin-top: 1rem;

	.saDot {
		height: 0.5rem;
		width: 0.5rem;
		background: @ColorGray400;
		border-radius: 999rem;
		animation: saChatLoading 1s infinite ease-in-out;

		&:nth-child(2) {
			animation-delay: 0.2s;
		}

		&:nth-child(3) {
			animation-delay: 0.4s;
		}
	}
}

@keyframes saChatLoading {
	0%,
	60%,
	100% {
		transform: translateY(0);
	}

	30% {
		transform: translateY(-0.25rem);
	}
}

.saChatWrapper {
	display: flex;
	flex-direction: column;
	width: 100%;
	height: 100%;
	justify-content: space-between;
	box-sizing: border-box;
	overflow: hidden;

	.saLargeScreen & {
		max-width: 48rem;
	}

	* {
		box-sizing: border-box;
	}
}

.saChatUnread {
	.FlexCentered();
	flex-direction: column;
	gap: 0.5rem;
	width: 100%;
	position: sticky;
	bottom: -0.5rem;
	padding: 2rem 0 1rem 0;
	pointer-events: none;
	z-index: 1;

	button {
		.FlexCentered();
		font-size: 0.75rem;
		line-height: 0.75rem;
		height: 1.5rem;
		width: fit-content;
		padding: 0 0.625rem;
		background-color: @ColorRed600;
		color: @ColorWhite;
		border-radius: 99rem;
		pointer-events: all;
		.StandardTransition();

		.Hover({
			background-color: @ColorRed700;
		});
		&:active {
			background-color: @ColorRed800;
		}
	}
}

.saChatDate {
	.FlexCentered();
	flex-direction: column;
	gap: 0.5rem;
	width: 100%;
	position: sticky;
	top: -1rem;
	padding: 2rem 0 1rem 0;
	pointer-events: none;
	z-index: 2;

	time {
		.FlexCentered();
		font-size: 0.75rem;
		line-height: 0.75rem;
		height: 1.5rem;
		width: fit-content;
		padding: 0 0.625rem;
		background-color: @ColorGray50;
		border: 1px solid @ColorGray200;
		border-radius: 99rem;
		pointer-events: all;
	}
}

.saChat {
	display: flex;
	flex-direction: column;
	height: 100%;
	position: relative;
	flex: 1;
	overflow: auto;
	padding: 0 1rem 1rem 1rem;

	.saLargeScreen & {
		border-radius: 1rem 1rem 0 0;
		border: 1px solid @ColorGray200;
		border-bottom: none;
		padding-right: 0;
		.ScrollbarHover();
	}
}

.saChatLatest {
	position: sticky;
	bottom: 0.5rem;
	left: 50%;
	transform: translate(-50%, 0);
	height: 2rem;
	width: 2rem;
	min-height: 2rem;
	min-width: 2rem;
	.FlexCentered();
	background-color: @ColorGray100;
	border: 1px solid @ColorGray200;
	border-radius: 99rem;
	color: @ColorGray600;
	transform-origin: center;
	transition: all 0.2s ease;

	&.saReached {
		transform: translate(-50%, 0.5rem);
		opacity: 0;
		pointer-events: none;
	}

	.Hover({
		color: @ColorBlue600;
		border-color: @ColorBlue600;
		background-color: @ColorBlue100;
	});

	&:active {
		color: @ColorBlue700;
		border-color: @ColorBlue700;
		background-color: @ColorBlue200;
	}
}

.saChatLog {
	display: flex;
	flex-direction: column;
	list-style-type: none;
	margin-block-start: 0;
	margin-block-end: 0;
	padding-inline-start: 0;
	overflow-wrap: break-word;
	z-index: 0;
}

.saChatResponse {
	font-size: 0.875rem;
	line-height: 1.5rem;

	&:last-child {
		margin-bottom: 8rem;
	}

	p:not(:last-child) {
		margin-bottom: 1rem;
	}

	.saSmallScreen & {
		font-size: 1rem;
		line-height: 1.5rem;
	}

	.saWord {
		animation: blurin 0.1s ease forwards;
	}

	@keyframes blurin {
		0% {
			filter: blur(8px);
			color: @ColorWhite;
		}
		100% {
			filter: blur(0);
			color: @ColorGray900;
		}
	}
}

.saChatToolbar {
	display: flex;
	flex-direction: row;
	gap: 0.25rem;
	list-style: none;
	height: 2rem;
	align-items: center;
	margin-top: 0.5rem;

	&.saFloating {
		position: absolute;
		margin-top: 0;
		top: -1.75rem;
		right: -1rem;
		background-color: @ColorGray900;
		border-radius: 0.625rem;
		padding: 0.25rem;

		.saSender & {
			right: 0;
		}
	}

	button {
		appearance: none;
		background-color: transparent;
		color: @ColorGray500;
		width: 1.5rem;
		height: 1.5rem;
		border-radius: 0.375rem;
		.StandardTransition();

		.saFloating& {
			color: @ColorGray200;
		}

		&:enabled {
			.Hover({
				background-color: @ColorBlue50;
				color: @ColorBlue600;

				.saFloating& {
					background-color: @ColorGray800;
					color: @ColorGray50;
				}
			});

			&:active {
				background-color: @ColorBlue100;
				color: @ColorBlue700;
				border-radius: 0.5rem;

				.saFloating& {
					background-color: @ColorGray700;
					color: @ColorWhite;
				}
			}
		}
	}

	.saSender & {
		justify-content: flex-end;
		opacity: 0;
	}

	.saFloating& {
		opacity: 0;
	}

	.saChatResponse & {
		animation: saRevealToolbar forwards 0.2s ease;

		@keyframes saRevealToolbar {
			0% {
				opacity: 0;
				height: 0;
			}
			100% {
				opacity: 1;
				height: 2rem;
			}
		}
	}
}

.saChatComposer {
	display: flex;
	position: relative;
	max-height: 50%;

	.saSmallScreen & {
		padding: 0 0.5rem 0 0.5rem;
	}

	textarea {
		appearance: none;
		width: 100%;
		height: 100%;
		resize: none;
		border: none;
		padding: 0.75rem 1rem;
		font-size: 0.875rem;
		line-height: 1.25rem;
		font-family: inherit;
		outline: none;
		color: inherit;
		field-sizing: content;
		min-height: 8rem;
		border: 1px solid @ColorGray200;
		background-color: @ColorWhite;

		.saLargeScreen & {
			border-radius: 0 0 1rem 1rem;
			padding-right: 0;
			.ScrollbarHover();
		}

		.saSmallScreen & {
			border-radius: 1.5rem;
			font-size: 1rem;
			line-height: 1.25rem;
			min-height: 3rem;
			padding: 0.75rem 3.5rem 0.75rem 1rem;
		}

		&::placeholder {
			color: @ColorGray400;
		}

		&:enabled {
			box-shadow: 0 1px 2px fade(@ColorGray900, 4), 0 2px 0.1875rem fade(@ColorGray900, 4);
		}

		&:disabled {
			background-color: @ColorGray100;
			color: @ColorGray300;
			cursor: not-allowed;
			box-shadow: none;
		}

		&.saError {
			background-color: @ColorRed50;
			border-color: @ColorRed600;
		}

		&.saWarning {
			background-color: @ColorYellow50;
			border-color: @ColorYellow200;
		}

		&.saHidden {
			display: none;
		}
	}
}

.saChatComposerInstruction {
	font-size: 0.75rem;
	line-height: 1rem;
	color: @ColorGray600;
	padding: 0.5rem 1rem;
	text-align: center;
	.Ellipsis();
}

.saChatButtonSend,
.saChatButtonStop {
	.Button();
	background-color: @ColorGray50;
	height: 2rem;
	width: 2rem;
	border-radius: 999rem;
	position: absolute;
	bottom: 0.5rem;
	right: 0.5rem;

	.saSmallScreen & {
		bottom: 0.5rem;
		right: 1rem;
	}
}

.saChatButtonSend {
	.ButtonPrimary();
}

.saChatButtonStop {
	.ButtonSecondary();
}

.saChatMessage {
	display: flex;
	align-items: end;
	gap: 0.5rem;
	padding: 0 2rem 1rem 0;

	&.saSender {
		justify-content: flex-end;
		padding: 0 0 1rem 2rem;

		&.saEdit {
			padding: 0;
		}
	}

	&:hover,
	&:focus-within {
		.saChatToolbar {
			opacity: 1;
		}
	}
}

.saChatAvatar {
	.FlexCentered();
	height: 1.5rem;
	min-width: 1.5rem;
	background-color: @ColorGray300;
	color: @ColorWhite;
	border-radius: 50%;
	font-size: 0.625rem;
	line-height: 1.5rem;
	transition: ease background 0.2s, ease transform 0.2s, ease opacity 0.2s;
	transform: scale(1);
	border-width: 1px;
	border-style: solid;
	margin-bottom: 1.25rem;

	&.saPrimary {
		background-color: @ColorBlue50;
		color: @ColorBlue600;
		border-color: @ColorBlue200;
	}

	&.saPurple {
		background-color: @ColorPurple50;
		color: @ColorPurple600;
		border-color: @ColorPurple200;
	}

	&.saGray {
		background-color: @ColorGray50;
		color: @ColorGray600;
		border-color: @ColorGray200;
	}

	&.saRed {
		background-color: @ColorRed50;
		color: @ColorRed600;
		border-color: @ColorRed200;
	}

	&.saOrange {
		background-color: @ColorOrange50;
		color: @ColorOrange600;
		border-color: @ColorOrange200;
	}

	&.saYellow {
		background-color: @ColorYellow50;
		color: @ColorYellow600;
		border-color: @ColorYellow200;
	}

	&.saGreen {
		background-color: @ColorGreen50;
		color: @ColorGreen600;
		border-color: @ColorGreen200;
	}

	&.saSky {
		background-color: @ColorSky50;
		color: @ColorSky600;
		border-color: @ColorSky200;
	}

	&.saPink {
		background-color: @ColorPink50;
		color: @ColorPink600;
		border-color: @ColorPink200;
	}
}

.saChatMessageInner {
	display: flex;
	flex-direction: column;
	width: 100%;
	position: relative;
	max-width: 28rem;

	.saSender & {
		align-items: flex-end;
	}

	.saEdit & {
		display: none;
	}
}

.saChatMessageFooter {
	display: flex;
	gap: 0.5rem;
	position: relative;
	min-height: 1rem;
	align-items: end;
	padding: 0.5rem 0 0 1rem;
}

.saChatMessageEdited {
	font-size: 0.75rem;
	line-height: 0.75rem;
	color: @ColorGray600;
}

.saChatSenderName {
	font-size: 0.75rem;
	line-height: 0.75rem;
	font-weight: 500;
}

.saChatMessageTime {
	font-size: 0.75rem;
	line-height: 0.75rem;
	color: @ColorGray600;
	position: relative;

	.saSender & {
		padding-right: 1rem;
	}

	&::after {
		content: '';
		display: flex;
		height: 0.375rem;
		width: 0.375rem;
		border-radius: 100%;
		background-color: @ColorRed600;
		position: absolute;
		right: -0.75rem;
		top: 0.1875rem;
		transition: ease opacity 0.2s, ease transform 0.2s, ease visibility 0.2s;
		transition-delay: 2s;
		opacity: 0;
		transform: scale(0);
		visibility: hidden;

		.saUnread & {
			opacity: 1;
			transform: scale(1);
			visibility: visible;
		}
	}
}

.saChatMessageBody {
	display: flex;
	flex-direction: column;
	gap: 0.25rem;

	.saSender & {
		align-items: flex-end;
	}

	img {
		border-radius: 0.25rem;
		width: 100%;
		margin: 0.5rem 0;

		&:first-child {
			margin-top: 0;
		}

		&:last-child {
			margin-bottom: 0;
		}
	}
}

.saChatMessageBody p {
	font-size: 0.875rem;
	line-height: 1.25rem;
	word-break: break-word;
	background-color: @ColorGray100;
	padding: 0.625rem 1rem;
	width: fit-content;
	border-radius: 0.25rem;
	min-width: 2.5rem;
	transition: border-radius ease 0.2s;

	.saSmallScreen & {
		font-size: 1rem;
		line-height: 1.25rem;
	}

	&:first-child {
		border-radius: 0.75rem 0.75rem 0.25rem 0.25rem;
	}

	&:last-child {
		border-radius: 0.25rem 0.25rem 0.75rem 0.125rem;
	}

	&:only-child {
		border-radius: 0.75rem 0.75rem 0.75rem 0.125rem;
	}

	.saSender & {
		background-color: @ColorBlue100;

		&:last-child {
			border-radius: 0.25rem 0.25rem 0.125rem 0.75rem;
		}

		&:only-child {
			border-radius: 0.75rem 0.75rem 0.125rem 0.75rem;
		}
	}
}

.saChatMessageEdit {
	display: flex;
	width: 100%;
	flex-direction: column;

	textarea {
		appearance: none;
		background-color: transparent;
		width: 100%;
		height: 100%;
		resize: none;
		border: none;
		outline: none;
		font-size: 0.875rem;
		line-height: 1.25rem;
		font-family: inherit;
		color: inherit;
		field-sizing: content;
		min-height: 8rem;
		max-height: 50dvh;
		background-color: @ColorWhite;
		border-radius: 0.75rem;
		border: none;
		padding: 0.625rem 0 0.625rem 1rem;

		&:enabled {
			outline: 1px solid @ColorGray200;
			outline-offset: -1px;
			box-shadow: 0 1px 2px fade(@ColorGray900, 3), 0 2px 0.1875rem fade(@ColorGray900, 3);

			.Hover({
				outline-color: @ColorBlue600;
				background-color: @ColorBlue50;
			});

			&:focus {
				outline-color: @ColorBlue600;
				outline-offset: -2px;
				outline-width: 2px;
				background-color: @ColorBlue50;
			}

			&.saError,
			&.saError:is(:hover, :focus) {
				background-color: @ColorRed50;
				outline-color: @ColorRed600;
				outline-width: 2px;
			}

			&.saWarning,
			&.saWarning:is(:hover, :focus) {
				background-color: @ColorYellow50;
				outline-color: @ColorYellow200;
				outline-width: 2px;
			}
		}

		&:disabled {
			background-color: @ColorGray100;
			outline-color: transparent;
			color: @ColorGray300;
		}

		.saLargeScreen & {
			.ScrollbarHover();
		}

		.saSmallScreen & {
			padding: 0.625rem 1rem 0.625rem 1rem;
			font-size: 1rem;
			line-height: 1.25rem;
		}
	}

	.saChatButtonGroup {
		display: flex;
		padding: 1rem 0 0 1rem;
		gap: 0.5rem;

		.saSmallScreen & {
			padding: 1rem 0 0 0;
		}

		button {
			min-width: 4rem;

			.saSmallScreen & {
				flex: 1;
			}
		}
	}
}

	</code></pre>
</body>
<script>
 $(document).ready(function () {
    // Chat application module
    const ChatApp = (function () {
        // DOM elements
        const $prompt = $('#prompt');
		const $theChat = $('#theChat');
        const $chatLog = $('#chatLog');
        const $latest = $('#latest');
        const $send = $('#send');
        const $stop = $('#stop');
        const $loader = $('#loading');

        // State management
        let state = 'idle'; // idle | thinking
        let responseTimeout = null;

        // Create toolbar for messages
        function createToolbar(isPrompt) {
            const $toolbar = $('<ul>')
                .attr({
                    'role': 'toolbar',
                    'aria-label': 'Message actions'
                })
                .addClass('saChatToolbar');

            const buttons = isPrompt
                ? [
                    { label: 'Edit message', icon: 'pen' },
                    { label: 'Copy message', icon: 'copy' },
					{ label: 'More actions', icon: 'ellipsis-vertical' }
                ]
                : [
                    { label: 'Copy message', icon: 'copy' },
                    { label: 'Try again', icon: 'arrow-rotate-right' },
                    { label: 'Crow', icon: 'crow' }
                ];

            buttons.forEach(({ label, icon }) => {
                $toolbar.append(
                    $('<li>').append(
                        $('<button>')
                            .attr({
                                'type': 'button',
                                'aria-label': label
                            })
                            .append($('<i>').addClass(`far fa-${icon} saIcon`))
                    )
                );
            });

            return $toolbar;
        }

        // Update send button state
        function updateSendButton() {
            $send.prop('disabled', !$prompt.val().trim());
        }

        // Manage sparkles animation
        function setLoading(show) {
            $loader
                .toggle(show)
                .attr('aria-busy', show ? 'true' : null);
        }

        // Update chat state
        function setState(newState) {
            state = newState;
            const isThinking = state === 'thinking';

            $send.toggle(!isThinking);
            $stop.toggle(isThinking);

            if (!isThinking) {
                updateSendButton();
            }
        }

        // Send and handle message
        function sendMessage() {
            const message = $prompt.val().trim();
            if (!message || state !== 'idle') return;

            // Add user prompt to chat log
			const lines = message.split(/\r?\n/);
			const $promptLi = $('<li>')
				.addClass('saChatMessage saSender')
				.append(
					$('<article>').addClass('saChatMessageInner').append(
						$('<div>').addClass('saChatMessageBody').append(
							lines.map(line => $('<p>').text(line))
						),
						$('<footer>').addClass('saChatMessageFooter').append(
							$('<time>')
								.addClass('saChatMessageTime')
								.attr({
									datetime: new Date().toISOString(),
									'aria-label': 'Sent just now'
								})
								.text(
									new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
								)
						),
						createToolbar(true)
					)
				);
			$chatLog.append($promptLi);

            // Reset input
            $prompt.val('');
            updateSendButton();
            $prompt.focus();
            scrollToBottom();

            // Set thinking state
            setState('thinking');

            // Simulate response with word-by-word reveal
            const responseLines = [
                "Absolutely, I can help you with that.",
                "Here are the steps you should follow:",
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
            ];

            const $responseLi = $('<li>').addClass('saChatResponse');
            $chatLog.append($responseLi);

            // Split response into words and track paragraph boundaries
            const words = responseLines.join(' ').split(/\s+/);
            const lineWordCounts = responseLines.map(line => line.split(/\s+/).length);
            let wordIndex = 0;
            let currentLineIndex = 0;
            let wordsInCurrentLine = 0;
            let currentP = $('<p>').appendTo($responseLi);

            function revealWord() {
                if (wordIndex < words.length) {
                    if (wordIndex > 0 && wordsInCurrentLine === 0) {
                        currentP = $('<p>').appendTo($responseLi); // Start new paragraph
                    } else if (wordIndex > 0) {
                        currentP.append(' ');
                    }
                    currentP.append($('<span>').text(words[wordIndex]).addClass('saWord'));
                    scrollToBottom();
                    wordIndex++;
                    wordsInCurrentLine++;

                    // Check if current paragraph is complete
                    if (wordsInCurrentLine >= lineWordCounts[currentLineIndex]) {
                        // Replace spans with paragraph text
                        currentP.html($('<div>').text(responseLines[currentLineIndex]).html());
                        currentLineIndex++;
                        wordsInCurrentLine = 0;
                    }

                    responseTimeout = setTimeout(revealWord, 25); // Adjust delay (25ms per word)
                } else {
                    $responseLi.append(createToolbar(false));
                    scrollToBottom();
                    setState('idle');
                }
            }

            // Remove loader and start revealing words after a short delay
            setLoading(false); // Loader removed at response start
            setTimeout(revealWord, 1000);

            // Handle stop button
            $stop.off('click').on('click', function () {
                clearTimeout(responseTimeout);
                // Replace all content with final paragraphs
                const finalHtml = responseLines.map(line => $('<p>').text(line).prop('outerHTML')).join('');
                $responseLi.html(finalHtml);
                $responseLi.append(createToolbar(false));
                setState('idle');
            });
        }

		// Enhanced scroll handler for chat day/date pills
		function enhancedHandleScroll() {

			$(".saChatDate").each(function (index) {
				const $current = $(this);
				const $pill = $current.find('time');
				const $next = $(".saChatDate").eq(index + 1);

				if ($next.length) {
					const distance = $next.offset().top - $current.offset().top;
					// Scale effect
					if (distance <= 100) {
						const scale = Math.max(0, distance / 100).toFixed(2);
						$pill.css("transform", `scale(${scale <= 0.1 ? 0 : scale})`);
					} else {
						$pill.css("transform", "scale(1)");
					}
					// Opacity effect
					if (distance <= 50) {
						const opacity = Math.max(0, distance / 50).toFixed(2);
						$pill.css("opacity", opacity <= 0.1 ? 0 : opacity);
					} else {
						$pill.css("opacity", "1");
					}
				}
			});
		}

        // Scroll chat log to bottom
        function scrollToBottom() {
            $theChat[0].scrollTop = $theChat[0].scrollHeight;
        }

		$('#scrollToBottom').click(function (e) {
			scrollToBottom();
		});

		$latest.click(function (e) {
			scrollToBottom();
		});

        // Handle scroll events
        function handleScroll() {
            const isAtBottom = Math.abs(
                $theChat[0].scrollHeight - $theChat[0].scrollTop - $theChat[0].clientHeight
            ) < 16;
            $latest.toggleClass('saReached', isAtBottom);
			 enhancedHandleScroll();
        }

        // Initialize event listeners
        function initEvents() {
            $prompt.on('input', function () {
                if (state === 'idle') updateSendButton();
            });

            $send.on('click', function (e) {
                e.preventDefault();
                sendMessage();
            });

            $prompt.on('keydown', function (e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            $stop.on('click', function () {
                clearTimeout(responseTimeout);
                setState('idle');
            });

            $theChat.on('scroll', handleScroll);
        }

        // Initialize the chat application
        function init() {
            initEvents();
            updateSendButton();
        }

        return { init };
    })();

    // Start the application
    ChatApp.init();
});
</script>

</html>