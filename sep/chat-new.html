<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Jonathan</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="../src/fontawesome/css/all.css">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
	<script type="text/javascript" src="https://livejs.com/live.js"></script>
	<link rel="icon" type="image/png" size="16x16" href="../src/img/favicon.svg">
</head>

<body class="saRootBody saLargeScreen saPc saCompact">
	<div class="saRootContentWrapper">
		<div class="saSideBar saSideBarJs saExpanded">
			<div id="aspnetForm">
				<nav id="SideBar">
					<div class="saPageHeader saSmallScreenHeader">
						<div class="saHeader">
							<div class="saTopRow">
								<button class="saNavigator" type="button">
									<div class="saNavBar saActive"><span class="saNavBarStripe"></span>
										<span class="saNavBarStripe"></span>
										<span class="saNavBarStripe"></span>
									</div>
								</button>
								<div class="saHeaderWrapper">
									<div class="saTitle">
										<h1>Softadmin® Utvecklingssystem</h1>
									</div>
								</div>
								<button class="saNotificationWrapper" type="button">
									<div><i class="far fa-bell saIcon"></i></div>
									<div class="saNotificationBadge saEmpty" aria-hidden="true">
										<div class="saNotificationBadgeCount">0</div>
									</div>
								</button>
							</div>
						</div>
					</div>
					<div class="saSidenav" id="sidenav">
						<div class="saSidenavSection">
							<div class="saCustomerLogo">
								<div>
									<img src="../src/img/logo.svg" alt="Softadmin® logo" style="min-height: 5rem;">
								</div>
							</div>
							<div class="saSidenavContainer">
								<div class="saSidenavItem saMenuDropdownsOuter">
									<div class="saSidenavItemWrapper">
										<label class="saInputTextWrapper saLabeled">
											<span class="saLabeledLabel">User</span>
											<span class="saFirstLetter">J</span>
											<select class="saInputText saDropdown">
												<option value="0" selected="true">Jonathan</option>
												<option value="1">Kevin</option>
											</select>
											<div class="saTrailingIconsWrapper">
												<i class="saIcon far fa-angle-down"></i>
											</div>
										</label>
									</div>
								</div>
								<div class="saToggleGroup" role="tablist" aria-label="Toggle menu/favorites">
									<button class="saDynamicTooltipJs" type="button" id="tabbutton1" role="tab"
										aria-selected="true">
										<i class="saIcon far fa-bars" aria-hidden="true"></i>
										<span class="saToggleText">Menu</span>
									</button>
									<button class="saDynamicTooltipJs" type="button" id="tabbutton2" role="tab">
										<i class="saIcon far fa-star" aria-hidden="true"></i>
										<span class="saToggleText">Favorites</span>
									</button>
								</div>
							</div>
							<div class="saSidenavLists">
								<ul class="saSidenavItemList">
									<li>
										<a class="saSidenavItemWrapper" tabindex="0">
											<div class="saSidenavItem">
												<i class="far fa-crow saIcon"></i>
												<span class="saSidenavItemText">Crow</span>
											</div>
										</a>
									</li>
									<li>
										<a class="saSidenavItemWrapper" tabindex="0">
											<div class="saSidenavItem">
												<i class="far fa-arrow-turn-down-left saIcon"></i>
												<span class="saSidenavItemText">Egg</span>
											</div>
										</a>
									</li>
									<li>
										<a class="saSidenavItemWrapper" tabindex="0">
											<div class="saSidenavItem">
												<i class="far fa-feather saIcon"></i>
												<span class="saSidenavItemText">Flying lessons</span>
											</div>
										</a>
									</li>
									<li>
										<a class="saSidenavItemWrapper" tabindex="0">
											<div class="saSidenavItem">
												<i class="far fa-ticket-alt saIcon"></i>
												<span class="saSidenavItemText">Aviary tickets</span>
											</div>
										</a>
									</li>
								</ul>
							</div>
						</div>
						<div class="saSidenavSection saSidenavSectionLast">
							<div class="saSidenavContainer">
								<div class="saListItem">
									<button class="saSidenavItemWrapper" type="button" aria-expanded="false">
										<div class="saSidenavItem saAvatarWrapperOuter">
											<div class="saAvatarWrapper saUserInitials" aria-hidden="true">JK</div>
											<span class="saSidenavItemText">Jonathan Kevin</span><i
												class="far fa-angle-down saIcon"></i>
										</div>
									</button>
								</div>
								<div class="saSidenavItem saSidenavItemRow">
									<button class="saSidenavItemWrapper" type="button">
										<div class="saSidenavItem">
											<i class="far fa-gear icon saIcon"></i>
											<span class="saSidenavItemText">Admin</span>
										</div>
									</button>
									<button class="saSidenavItemWrapper" type="button">
										<div class="saSidenavItem">
											<i class="far fa-person-limbs-wide icon saIcon"></i>
											<span class="saSidenavItemText">Database designer</span>
										</div>
									</button>
									<button class="saSidenavItemWrapper" type="button">
										<div class="saSidenavItem">
											<i class="far fa-window-restore icon saIcon"></i>
											<span class="saSidenavItemText">Ny flik</span>
										</div>
									</button>
									<button class="saSidenavItemWrapper" type="button">
										<div class="saSidenavItem">
											<i class="far fa-circle-question icon saIcon"></i>
											<span class="saSidenavItemText">Visa hjälpsida - Allmän hjälpsida</span>
										</div>
									</button>
									<button class="saSidenavItemWrapper saNotificationLinkLargeScreen" type="button">
										<div class="saSidenavItem">
											<div><i class="far fa-bell saIcon"></i></div>
											<span class="saSidenavItemText">Notifieringar</span>
										</div>
										<div class="saNotificationBadge saEmpty" aria-hidden="true">
											<div class="saNotificationBadgeCount">0</div>
										</div>
									</button>
								</div>
							</div>
							<div class="saSidenavFooter">
								<a class="saSoftadminLogo" rel="noopener noreferrer" tabindex="-1" href="#">
									<img class="saLogo" src="../src/img/softadmin-logo-minimized.svg">
									<img class="saWordmark" src="../src/img/softadmin-logo-expanded.svg">
								</a>
								<button class="saExpander saDynamicTooltipJs" type="button">
									<i class="fa-angles-left far saIcon"></i>
								</button>
							</div>
						</div>
					</div>
				</nav>
			</div>
		</div>
		<div class="saRightFrameRoot">
			<div class="right standardview">
				<div class="pagecontentframe">
					<div class="interface">
						<header id="pageheader" class="saPageHeaderHolder">
							<div class="saPageHeader saDesktopHeader">
								<div class="saHeader">
									<div class="saRowWrapper">
										<div class="saTopRow">
											<nav class="saBreadcrumbs">
												<div class="saBackButtonWrapper">
													<button class="saBackButton" type="button" disabled>
														<i class="fa-arrow-left far saBack saIcon"></i>
													</button>
												</div>
											</nav>
										</div>
										<div class="saBottomRow">
											<div class="saTitle">
												<h1 class="saHeaderText">Test</h1>
												<div class="saMarkFavorite saNoSpinner"><button type="button"><i
															class="fas fa-star saFavoriteIcon saFavoriteAdded icon saIcon"></i></button>
												</div>
												<ul class="saSpecialLinksWrapper"></ul>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="saPageHeader saSmallScreenHeader">
								<div class="saHeader">
									<div class="saHeaderInner">
										<div class="saTopRow">
											<div class="saHeaderWrapper">
												<div class="saTitle">
													<h1 class="saHeaderText">Test</h1>
												</div>
											</div>
											<button class="saNavigator" type="button">
												<div class="saNavBar"><span class="saNavBarStripe"></span><span
														class="saNavBarStripe"></span><span
														class="saNavBarStripe"></span>
												</div>
											</button>
											<button class="saNotificationWrapper" type="button" aria-live="polite">
												<div><i class="far fa-bell saIcon"></i></div>
												<div class="saNotificationBadge saEmpty" aria-hidden="true">
													<div class="saNotificationBadgeCount">0</div>
												</div>
											</button>
										</div>
									</div>
									<nav class="saBottomRow saActionLinkBar" style="display: none;"></nav>
								</div>
							</div>
						</header>
						<div class="maincolinner gradients">
							<main id="MI_M" class="menuitem pagecontentframe">
								<div id="MI_ScrollIndicator" class="scrollindicator"></div>
								<div id="MI_ScrollContent" class="scrollcontent saScrollable">
									<div class="scrollcontent-inner">
										<section aria-label="Support chat" class="saChat" role="region" id="chat">
											<ol id="chat-log" role="log" aria-live="polite" aria-relevant="additions"
												aria-label="Chat messages">
											</ol>
											<p id="log-help" class="saScreenReaderOnly">
												New messages appear at the bottom. This list updates automatically.
												Use arrow keys or Page Up/Down to browse. Press "Jump to latest" to
												scroll down.
											</p>
											<div class="saChatControls">
												<button type="button" id="jump-latest" hidden
													aria-describedby="jump-latest-desc">Jump to latest</button>
												<div id="jump-latest-desc" class="saScreenReaderOnly">Jump to the
													most recent message in the chat</div>
												<div id="typing" role="status" aria-live="polite" aria-atomic="true"
													hidden>Alex is typing…</div>
											</div>
											<form id="composer" class="saComposer" aria-labelledby="composer-label">
												<label id="composer-label" for="message">Message</label>
												<div class="saComposerToolbar">
													<button type="button" aria-label="Insert emoji"
														aria-describedby="emoji-desc">
														<i class="saIcon far fa-face-smile" aria-hidden="true"></i>
													</button>
													<div id="emoji-desc" class="saScreenReaderOnly">Opens emoji
														picker</div>
													<label for="file-input" aria-describedby="file-desc">
														<span class="saScreenReaderOnly">Attach file</span>
														<input type="file" multiple id="file-input"
															class="saScreenReaderOnly">
														<i class="saIcon far fa-paperclip" aria-hidden="true"></i>
													</label>
													<div id="file-desc" class="saScreenReaderOnly">Select files to
														attach to your message</div>
												</div>
												<textarea id="message" name="message" rows="2" aria-controls="chat-log"
													aria-describedby="composer-help" placeholder="Type your message...">
                </textarea>
												<ul class="saAttachmentList" aria-label="Attached files" role="list">
												</ul>
												<p id="composer-help" class="saScreenReaderOnly">
													Press Enter to send. Shift+Enter inserts a line break. Drag and
													drop files anywhere in the chat area to attach them.
												</p>
												<button type="submit" aria-label="Send message" disabled>
													<span class="saScreenReaderOnly">Send</span>
													<i class="saIcon far fa-paper-plane" aria-hidden="true"></i>
												</button>
											</form>
										</section>
									</div>

									<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
									<script>
										jQuery(document).ready(function ($) {
											const $log = $('#chat-log');
											const $composer = $('#composer');
											const $input = $('#message');
											const $sendButton = $composer.find('button[type="submit"]');
											const $jump = $('#jump-latest');
											const $attachInput = $('#file-input');
											const $attachmentList = $('.saAttachmentList');
											const $scrollContentInner = $('.scrollcontent-inner');

											// Validate required elements exist
											const requiredElements = {
												'#chat-log': $log,
												'#composer': $composer,
												'#message': $input,
												'#jump-latest': $jump,
												'.saAttachmentList': $attachmentList,
												'.scrollcontent-inner': $scrollContentInner
											};

											for (const [selector, $element] of Object.entries(requiredElements)) {
												if (!$element.length) {
													console.error(`Required element ${selector} not found`);
													return;
												}
											}

											let msgId = 1;
											let lastMessageTime = null;
											let lastMessageFrom = null;
											let lastMessageDay = null;
											let attachments = [];

											// Chat history data
											const chatHistory = [
												{
													from: 'You',
													fullName: 'Me',
													initials: 'ME',
													text: 'Hey Alex, can you help with a bug in the login system?',
													timestamp: '2025-09-08T10:30:00+02:00',
													sender: true
												},
												{
													from: 'Alex Holm',
													fullName: 'Alex Holm',
													initials: 'AH',
													text: 'Sure, can you share a screenshot of the error?',
													timestamp: '2025-09-08T10:31:00+02:00',
													sender: false
												},
												{
													from: 'You',
													fullName: 'Me',
													initials: 'ME',
													text: 'Here\'s the screenshot.',
													timestamp: '2025-09-08T10:31:30+02:00',
													sender: true
												},
												{
													from: 'Alex Holm',
													fullName: 'Alex Holm',
													initials: 'AH',
													text: 'Got it, looks like a session timeout issue. Try clearing your cookies.',
													timestamp: '2025-09-08T10:32:00+02:00',
													sender: false
												},
												{
													from: 'You',
													fullName: 'Me',
													initials: 'ME',
													text: 'Still not working. Here\'s a debug log.',
													timestamp: '2025-09-09T09:15:00+02:00',
													sender: true
												},
												{
													from: 'Alex Holm',
													fullName: 'Alex Holm',
													initials: 'AH',
													text: 'Thanks, I\'ll review the log and get back to you.',
													timestamp: '2025-09-09T09:16:00+02:00',
													sender: false
												},
												{
													from: 'You',
													fullName: 'Me',
													initials: 'ME',
													text: 'Any updates?',
													timestamp: '2025-09-09T11:58:00+02:00',
													sender: true
												}
											];

											// Utility functions
											function isNearBottom() {
												const scrollHeight = $log[0].scrollHeight;
												const scrollTop = $log.scrollTop();
												const clientHeight = $log.innerHeight();
												return scrollHeight - scrollTop - clientHeight < 48;
											}

											function scrollToBottom(animate = true) {
												const scrollHeight = $log[0].scrollHeight;
												if (animate) {
													$log.animate({ scrollTop: scrollHeight }, 300);
												} else {
													$log.scrollTop(scrollHeight);
												}
											}

											function getDateLabel(date) {
												const today = new Date('2025-09-09T20:35:00+02:00');
												const yesterday = new Date(today);
												yesterday.setDate(yesterday.getDate() - 1);

												if (date.toDateString() === today.toDateString()) {
													return 'Today';
												} else if (date.toDateString() === yesterday.toDateString()) {
													return 'Yesterday';
												} else {
													return date.toLocaleDateString('en-US', {
														year: 'numeric',
														month: 'long',
														day: 'numeric'
													});
												}
											}

											function insertDateSeparator(now) {
												const currentDay = now.toDateString();
												if (lastMessageDay !== currentDay) {
													const label = getDateLabel(now);
													const $separator = $('<li>', {
														role: 'separator',
														class: 'saChatDay',
														'aria-label': `Messages from ${label}`
													}).append(
														$('<time>', {
															datetime: now.toISOString().split('T')[0]
														}).text(label)
													);
													$log.append($separator);
													lastMessageDay = currentDay;
												}
											}

											function formatFileSize(bytes) {
												if (bytes < 1024) return `${bytes} B`;
												if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
												return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
											}

											function getFileIcon(file) {
												const type = file.type || '';
												if (type.startsWith('image/')) return 'fa-image';
												if (type === 'application/pdf') return 'fa-file-pdf';
												if (type.startsWith('text/')) return 'fa-file-alt';
												if (type.startsWith('video/')) return 'fa-file-video';
												if (type.startsWith('audio/')) return 'fa-file-audio';
												return 'fa-file';
											}

											function addAttachment(file) {
												const fileId = `attachment-${Date.now()}-${Math.random()}`;
												const $li = $('<li>', {
													class: 'saAttachmentItem'
												});

												const isImage = file.type.startsWith('image/');
												const fileUrl = URL.createObjectURL(file);

												const $link = $('<a>', {
													href: fileUrl,
													download: file.name,
													'aria-describedby': `${fileId}-desc`,
													'aria-label': `Download ${file.name}, ${formatFileSize(file.size)}`
												});

												const $icon = $('<i>', {
													class: `saIcon far ${getFileIcon(file)}`,
													'aria-hidden': 'true'
												});

												const $preview = isImage ? $('<img>', {
													src: fileUrl,
													alt: '',
													class: 'saAttachmentPreview',
													'aria-hidden': 'true'
												}) : null;

												const $info = $('<div>');
												const $name = $('<div>').text(file.name);
												const $size = $('<div>', {
													id: `${fileId}-desc`,
													class: 'saScreenReaderOnly'
												}).text(`File size: ${formatFileSize(file.size)}`);

												const $removeBtn = $('<button>', {
													type: 'button',
													'aria-label': `Remove file ${file.name}`,
													class: 'saRemoveAttachment'
												}).append($('<i>', {
													class: 'saIcon far fa-trash-alt',
													'aria-hidden': 'true'
												}));

												$info.append($name, $size);
												$link.append($icon, $preview, $info);
												$li.append($link, $removeBtn);
												$attachmentList.append($li);

												attachments.push(file);
												updateSendButtonState();

												// Announce attachment added
												announceToScreenReader(`File ${file.name} attached`);

												$removeBtn.on('click', function () {
													if ($preview) URL.revokeObjectURL($preview.attr('src'));
													URL.revokeObjectURL($link.attr('href'));
													$li.remove();
													attachments = attachments.filter(f => f !== file);
													updateSendButtonState();
													announceToScreenReader(`File ${file.name} removed`);
												});
											}

											function updateSendButtonState() {
												const hasContent = $input.val().trim() !== '' || attachments.length > 0;
												$sendButton.prop('disabled', !hasContent);

												if (hasContent) {
													$sendButton.attr('aria-label', 'Send message');
												} else {
													$sendButton.attr('aria-label', 'Send message (disabled - enter text or attach files)');
												}
											}

											function announceToScreenReader(message) {
												const $announcement = $('<div>', {
													role: 'status',
													'aria-live': 'polite',
													class: 'saScreenReaderOnly'
												}).text(message);

												$('body').append($announcement);
												setTimeout(() => $announcement.remove(), 2000);
											}

											function createMessageStructure({ from, fullName, initials, text, sender = false, files = [], timestamp }) {
												const now = timestamp ? new Date(timestamp) : new Date();
												const currentMinute = Math.floor(now.getTime() / 60000);
												const lastMinute = lastMessageTime ? Math.floor(lastMessageTime.getTime() / 60000) : null;
												const messageId = `message-${msgId++}`;

												insertDateSeparator(now);

												let $targetLi, $article, $contentWrapper;

												// Check if we can append to the last message (same sender, same minute)
												if (lastMessageFrom === from && currentMinute === lastMinute) {
													$targetLi = $log.children('li').last();
													if ($targetLi.hasClass('saChatMessage')) {
														$article = $targetLi.find('article');
														$contentWrapper = $article.find('.saChatContent');
													}
												}

												// Create new message if we can't append
												if (!$targetLi || !$article.length || !$contentWrapper.length) {
													const messageClasses = sender ? 'saChatMessage saSender' : 'saChatMessage';

													$targetLi = $('<li>', {
														class: messageClasses,
														'data-id': msgId - 1,
														'data-read': 'false',
														'data-from': from,
														id: messageId
													});

													$article = $('<article>', {
														'aria-labelledby': `${messageId}-from`,
														'aria-describedby': `${messageId}-time`
													});

													$contentWrapper = $('<div>', { class: 'saChatContent' });

													const $footer = $('<footer>').append(
														$('<span>', {
															class: 'saChatFrom',
															id: `${messageId}-from`
														}).text(from),
														' ',
														$('<time>', {
															datetime: now.toISOString(),
															id: `${messageId}-time`
														}).text(now.toLocaleTimeString('en-US', {
															hour: '2-digit',
															minute: '2-digit',
															hour12: false
														}))
													);

													const $header = $('<header>', {
														class: 'saChatAvatar',
														'aria-label': fullName,
														'aria-hidden': 'true'
													}).text(initials);

													// Structure based on sender status
													if (sender) {
														$contentWrapper.append($footer);
														$article.append($contentWrapper, $header);
													} else {
														$contentWrapper.append($footer);
														$article.append($header, $contentWrapper);
													}

													$targetLi.append($article);
													$log.append($targetLi);
												}

												// Add message text
												if (text && text.trim()) {
													const $paragraph = $('<p>').text(text);
													$contentWrapper.find('footer').before($paragraph);
												}

												// Add file attachments
												if (files.length > 0) {
													let $fileList = $contentWrapper.find('ul.saAttachmentList');
													if (!$fileList.length) {
														$fileList = $('<ul>', {
															class: 'saAttachmentList',
															'aria-label': 'Message attachments',
															role: 'list'
														});
														$contentWrapper.find('footer').before($fileList);
													}

													files.forEach(file => {
														const isImage = file.type.startsWith('image/');
														const fileUrl = URL.createObjectURL(file);
														const attachmentId = `msg-attachment-${Date.now()}-${Math.random()}`;

														const $li = $('<li class="saAttachmentItem">');

														const $link = $('<a>', {
															href: fileUrl,
															download: file.name,
															'aria-label': `Download ${file.name}, ${formatFileSize(file.size)}`,
															'aria-describedby': `${attachmentId}-desc`
														});

														const $icon = $('<i>', {
															class: `saIcon far ${getFileIcon(file)}`,
															'aria-hidden': 'true'
														});

														const $preview = isImage ? $('<img>', {
															src: fileUrl,
															alt: '',
															class: 'saAttachmentPreview',
															'aria-hidden': 'true'
														}) : null;

														const $info = $('<div>');
														const $name = $('<div>').text(file.name);
														const $size = $('<div>', {
															id: `${attachmentId}-desc`,
															class: 'saScreenReaderOnly'
														}).text(`File size: ${formatFileSize(file.size)}`);

														const $downloadIcon = $('<i>', {
															class: 'saIcon far fa-arrow-down-to-bracket',
															'aria-hidden': 'true'
														});

														$info.append($name, $size);
														$link.append($icon, $preview, $info, $downloadIcon);
														$li.append($link);
														$fileList.append($li);

														// Clean up object URLs after a delay
														setTimeout(() => {
															if ($preview) URL.revokeObjectURL($preview.attr('src'));
															URL.revokeObjectURL($link.attr('href'));
														}, 60000);
													});
												}

												lastMessageTime = now;
												lastMessageFrom = from;

												// Handle scrolling and read status
												if (!timestamp) {
													// New message sent by user
													scrollToBottom(true);
													markAsRead($targetLi);
													$jump.attr('hidden', true);
												} else if (isNearBottom()) {
													// Historical message and user is at bottom
													scrollToBottom(true);
													markAsRead($targetLi);
													$jump.attr('hidden', true);
												} else {
													// Historical message and user is not at bottom
													$jump.removeAttr('hidden');
												}

												return $targetLi;
											}

											function markAsRead($msg) {
												if ($msg.attr('data-read') === 'false') {
													$msg.attr('data-read', 'true').removeClass('saUnread');
												}
											}

											function markVisibleAsRead() {
												const containerRect = $log[0].getBoundingClientRect();

												$log.find('li[data-read="false"]').each(function () {
													const rect = this.getBoundingClientRect();
													if (rect.top >= containerRect.top && rect.bottom <= containerRect.bottom) {
														markAsRead($(this));
													}
												});

												if ($log.find('li[data-read="false"]').length === 0) {
													$jump.attr('hidden', true);
												}
											}

											// Event handlers
											function handleDragOver(e) {
												e.preventDefault();
												e.stopPropagation();
												$(this).addClass('saDragOver');
												$attachmentList.attr('aria-label', 'Attached files (drop files here to attach)');
											}

											function handleDragLeave(e) {
												e.preventDefault();
												e.stopPropagation();
												if (e.target === this) {
													$(this).removeClass('saDragOver');
													$attachmentList.attr('aria-label', 'Attached files');
												}
											}

											function handleDrop(e) {
												e.preventDefault();
												e.stopPropagation();
												$(this).removeClass('saDragOver');
												$attachmentList.attr('aria-label', 'Attached files');

												const files = Array.from(e.originalEvent.dataTransfer.files);
												files.forEach(file => addAttachment(file));

												const fileWord = files.length === 1 ? 'file' : 'files';
												announceToScreenReader(`${files.length} ${fileWord} attached`);
											}

											// Set up drag and drop
											$scrollContentInner.on('dragover', handleDragOver);
											$scrollContentInner.on('dragenter', handleDragOver);
											$scrollContentInner.on('dragleave', handleDragLeave);
											$scrollContentInner.on('drop', handleDrop);

											// Load chat history
											chatHistory.forEach(message => {
												createMessageStructure(message);
											});

											// Initial setup
											scrollToBottom(false);
											markVisibleAsRead();
											updateSendButtonState();

											// Input event handlers
											$input.on('input', updateSendButtonState);

											$input.on('keydown', function (e) {
												if (e.key === 'Enter' && !e.shiftKey) {
													e.preventDefault();
													if (!$(this).prop('disabled')) {
														$composer.trigger('submit');
													}
												}
											});

											// File input handler
											$attachInput.on('change', function () {
												const files = Array.from(this.files);
												files.forEach(file => addAttachment(file));
												this.value = '';
											});

											// Form submit handler
											$composer.on('submit', function (e) {
												e.preventDefault();
												const text = $input.val().trim();

												if (!text && attachments.length === 0) return;

												createMessageStructure({
													from: 'You',
													fullName: 'Me',
													initials: 'ME',
													text,
													files: [...attachments],
													sender: true
												});

												$input.val('').focus();
												$attachmentList.empty();
												attachments = [];
												updateSendButtonState();

												announceToScreenReader('Message sent');
											});

											// Emoji button placeholder
											$composer.find('button[aria-label^="Insert emoji"]').on('click', function () {
												announceToScreenReader('Emoji picker would open here');
											});

											// Scroll handler
											$log.on('scroll', function () {
												markVisibleAsRead();
												if (isNearBottom()) {
													$jump.attr('hidden', true);
												} else {
													$jump.removeAttr('hidden');
												}
											});

											// Jump to latest handler
											$jump.on('click', function () {
												scrollToBottom(true);
												markVisibleAsRead();
												$jump.attr('hidden', true);
												$input.focus();
												announceToScreenReader('Jumped to latest message');
											});

											// Focus management
											$input.focus();
										});
									</script>
								</div>
							</main>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>