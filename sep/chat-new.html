<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Jonathan</title>
	<link rel="stylesheet" href="./src/style/screen.template.css">
	<link rel="stylesheet" href="../src/fontawesome/css/all.css">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
		integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="./script.js"></script>
	<script type="text/javascript" src="https://livejs.com/live.js"></script>
	<link rel="icon" type="image/png" size="16x16" href="../src/img/favicon.svg">
</head>

<body class="saRootBody saLargeScreen saPc saCompact">
	<a href="./src/style/Chat.less">LESS</a>
	<fieldset id="settings1">
		<legend>Settings</legend>
		<label><input name="settings1" id="enable" type="radio" checked>Enabled</label>
		<label><input name="settings1" id="disable" type="radio">Disabled</label>
		<label><input name="settings1" id="error" type="radio">Error</label>
		<label><input name="settings1" id="warning" type="radio">Warning</label>
		<label><input name="settings1" id="hidden" type="radio">Hidden</label>
	</fieldset>
	<script>
		$(function() {
			const $editor = $('#editor');
			const $prompt = $('#prompt');
			const $send = $('#send');
			const $editButtons = $('#editButtons');
			const $error1 = $('#error1');
			const $warning1 = $('#warning1');
			const $error2 = $('#error2');
			const $warning2 = $('#warning2');

			function hideAllValidation() {
				$error1.hide();
				$warning1.hide();
				$error2.hide();
				$warning2.hide();
			}

			hideAllValidation();

			$('input[name="settings1"]').on('change', function() {
				const id = this.id;
				$prompt.removeClass('saError saWarning saHidden').prop('disabled', false)
					.removeAttr('invalid aria-errormessage');
				$editor.removeClass('saError saWarning saHidden').prop('disabled', false)
					.removeAttr('invalid aria-errormessage');
				$send.show();
				$editButtons.show();
				hideAllValidation();

				switch (id) {
					case 'error':
						$prompt.addClass('saError').attr({'invalid': 'true', 'aria-errormessage': 'error1'});
						$editor.addClass('saError').attr({'invalid': 'true', 'aria-errormessage': 'error2'});
						$error1.show();
						$error2.show();
						break;
					case 'warning':
						$prompt.addClass('saWarning');
						$editor.addClass('saWarning');
						$warning1.show();
						$warning2.show();
						break;
					case 'hidden':
						$prompt.addClass('saHidden');
						$editor.addClass('saHidden');
						break;
					case 'disable':
						$prompt.prop('disabled', true);
						$editor.prop('disabled', true);
						$send.hide();
						$editButtons.hide();
						break;
				}
			});

			// Handle cancel and save for .saEdit message
			const $editForm = $('.saMessage.saEdit .saMessageEdit');
			const $editMessage = $('.saMessage.saEdit');
			const $editTextarea = $editForm.find('textarea');
			const $editBody = $editMessage.find('.saMessageBody');
			const $saveBtn = $editForm.find('button[type="submit"]');
			const $footer = $editMessage.find('.saMessageFooter');

			// Track original value for change detection
			let originalEditValue = $editTextarea.val();

			$editTextarea.on('input', function() {
				const changed = $(this).val() !== originalEditValue;
				$saveBtn.prop('disabled', !changed);
			});

			$editForm.on('reset', function(e) {
				e.preventDefault();
				$editMessage.removeClass('saEdit');
				$editForm.hide();
				$editBody.show();
				$editTextarea.val(originalEditValue);
				$saveBtn.prop('disabled', true);
				$footer.find('.saMessageEdited').remove();
			});

			$editForm.on('submit', function(e) {
				e.preventDefault();
				const newText = $editTextarea.val();
				$editBody.html('<p>' + $('<div>').text(newText).html().replace(/\n/g, '</p><p>') + '</p>');
				$editMessage.removeClass('saEdit');
				$editForm.hide();
				$editBody.show();
				originalEditValue = newText;
				$saveBtn.prop('disabled', true);
				if ($footer.find('.saMessageEdited').length === 0) {
					$footer.prepend('<span class="saMessageEdited">Edited</span>');
				}
			});

			// Trigger edit state when clicking edit button
			$('.saMessage .saChatToolbar button[aria-label="Edit message"]').on('click', function(e) {
				e.preventDefault();
				$editMessage.addClass('saEdit');
				$editForm.show();
				$editBody.hide();
				$editTextarea.focus();
				originalEditValue = $editTextarea.val();
				$saveBtn.prop('disabled', true);
			});

			// Save on Enter, newline on Shift+Enter in edit textarea
			$editTextarea.on('keydown', function(e) {
				if (e.key === 'Enter' && !e.shiftKey) {
					e.preventDefault();
					$editForm.submit();
				}
				// Shift+Enter: default behavior (newline)
			});
		});
	</script>
	<div class="saChatWrapper">
		<div class="saChat" id="theChat">
			<ol class="saLog" aria-role="log" aria-relevant="additions" id="chatLog"
				aria-label="The Chat">
				<li role="separator" class="saChatDate"><time datetime="2025-10-08">Yesterday</time></li>
				<li class="saMessage">
					<div title="Olivia Rydén" class="saChatAvatar saPink">JM</div>
					<article class="saMessageInner">
						<div class="saMessageBody">
							<p>Wings UP team! As we navigate through our tasks today.</p>
							<p>Wings UP team! As we navigate through our tasks today.</p>
							<p>Wings UP team! As we navigate through our tasks today.</p>
						</div>
						<footer class="saMessageFooter">
							<div class="saSenderName">Jessica Mås</div>
							<time class="saMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">11:01</time>
						</footer>
					</article>
				</li>
				<li role="separator" class="saChatDate"><time datetime="2025-10-08">Tomorrow</time></li>
				<li class="saMessage">
					<div title="Olivia Rydén" class="saChatAvatar saPink">JM</div>
					<article class="saMessageInner">
						<div class="saMessageBody">
							<p>Wings UP team! As we navigate through our tasks today.</p>
							<p>Wings UP team! As we navigate through our tasks today.</p>
							<p>Wings UP team! As we navigate through our tasks today.</p>
						</div>
						<footer class="saMessageFooter">
							<div class="saSenderName">Jessica Mås</div>
							<time class="saMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">11:01</time>
						</footer>
					</article>
				</li>
				<li class="saMessage saEdit saSender">
					<article class="saMessageInner">
						<div class="saMessageBody">
							<p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Deserunt mollitia rerum hic ducimus nulla soluta, reiciendis eveniet omnis quod obcaecati numquam porro ullam reprehenderit atque quis. Doloribus natus sit omnis! Lorem ipsum dolor sit amet consectetur adipisicing elit. Inventore accusamus recusandae itaque corporis nostrum accusantium quia fuga adipisci temporibus laboriosam quas ullam enim tenetur repellat fugit, in perspiciatis sed quos. Lorem ipsum dolor sit amet consectetur adipisicing elit. Perspiciatis sed ratione delectus ipsum! Beatae blanditiis porro voluptas quidem, deserunt illum laboriosam repellat provident dolorem, possimus rem corrupti quo officia repudiandae.</p>
						</div>
						<footer class="saMessageFooter">
							<time class="saMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">11:01</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
						</ul>
					</article>
					<form class="saMessageEdit">
						<label for="editor" class="saScreenReaderOnly">Edit text of message you sent on 12 December 2025 at 11:15</label>
						<textarea id="editor">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Deserunt mollitia rerum hic ducimus nulla soluta, reiciendis eveniet omnis quod obcaecati numquam porro ullam reprehenderit atque quis. Doloribus natus sit omnis! Lorem ipsum dolor sit amet consectetur adipisicing elit. Inventore accusamus recusandae itaque corporis nostrum accusantium quia fuga adipisci temporibus laboriosam quas ullam enim tenetur repellat fugit, in perspiciatis sed quos. Lorem ipsum dolor sit amet consectetur adipisicing elit. Perspiciatis sed ratione delectus ipsum! Beatae blanditiis porro voluptas quidem, deserunt illum laboriosam repellat provident dolorem, possimus rem corrupti quo officia repudiandae.</textarea>
						<div class="saValidationMessage saError" id="error2"><i class="saIcon fas fa-octagon-xmark" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Error or warning goes here</div></div>
						<div class="saValidationMessage saWarning" id="warning2"><i class="saIcon fas fa-triangle-exclamation" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Warning goes here</div></div>
						<div class="saButtonGroup" id="editButtons">
							<button type="submit" class="saDefaultButtonPrimary" disabled>Save</button>
							<button type="reset" class="saDefaultButtonSecondary">Cancel</button>
						</div>
					</form>
				</li>
				<li role="separator" class="saChatUnread">
					<button type="button" id="scrollToBottom">New message(s)</button>
				</li>
				<li class="saMessage saUnread">
					<img loading="lazy" title="Stefan Stefan" class="saChatAvatar" src="https://untitledui.com/images/avatars/loki-bright" alt="Avatar of Stefan Stefan">
					<div class="saMessageInner">
						<div class="saMessageBody">
							<p>With unity and determination, there's no limit to what we can achieve!</p>
						</div>
						<footer class="saMessageFooter">
							<div class="saSenderName">Erik Öster</div>
							<time class="saMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 08:11">08:11</time>
						</footer>
					</div>
				</li>
				<li class="saMessage saSender">
					<article class="saMessageInner">
						<div class="saMessageBody">
							<p>today?</p>
							<p>or?</p>
							<p>tomorrow?</p>
						</div>
						<footer class="saMessageFooter">
							<time class="saMessageTime" datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:00">11:01</time>
						</footer>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
						</ul>
					</article>
				</li>

				<li class="saMessage saSender">
					<article class="saMessageInner">
						<div class="saMessageBody">
							<p>today?</p>
						</div>
						<ul role="toolbar" aria-label="Message actions" class="saChatToolbar">
							<li><button type="button" aria-label="Edit message"><i class="far fa-pen saIcon"></i></button></li>
							<li><button type="button" aria-label="Copy message"><i class="far fa-copy saIcon"></i></button></li>
						</ul>
						<div class="saScreenReaderOnly">
							<time datetime="2026-01-12T12:15:12+02:00" aria-label="Sent at 11:01">11:01</time>
						</div>
					</article>
				</li>
				<li class="saResponse">
					<article>
						<p>Sure,</p>
						<p>Let's make sure we're on track to resolve it efficiently. Also, it's time we discuss the bird bill of sale. I'll be available for a meeting later today to go over the details. Looking forward to hearing from everyone!</p>
					</article>
					<ul class="saChatToolbar" role="toolbar" aria-label="Message actions">
						<li>
							<button type="button" title="Copy message" aria-label="Copy message">
								<i class="far fa-copy saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Redo" aria-label="Try again">
								<i class="far fa-arrow-rotate-right saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Crow" aria-label="Crow">
								<i class="far fa-crow saIcon"></i>
							</button>
						</li>
					</ul>
				</li>
				<li role="separator" class="saChatDate">
					<time datetime="2025-10-08">Today</time>
				</li>
				<li class="saResponse">
					<article>
						<p>Sure,</p>
						<p>Let's make sure we're on track to resolve it efficiently. Also, it's time we discuss the bird bill of sale. I'll be available for a meeting later today to go over the details. Looking forward to hearing from everyone!</p>
					</article>
					<ul class="saChatToolbar" role="toolbar" aria-label="Message actions">
						<li>
							<button type="button" title="Copy message" aria-label="Copy message">
								<i class="far fa-copy saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Redo" aria-label="Try again">
								<i class="far fa-arrow-rotate-right saIcon"></i>
							</button>
						</li>
						<li>
							<button type="button" title="Crow" aria-label="Crow">
								<i class="far fa-crow saIcon"></i>
							</button>
						</li>
					</ul>
				</li>
				<li class="saChatLoading" id="loading" role="separator" aria-busy="true">
					<div class="saDot" aria-hidden="true"></div>
					<div class="saDot" aria-hidden="true"></div>
					<div class="saDot" aria-hidden="true"></div>
				</li>
			</ol>
			<button type="button" class="saChatLatest saReached" id="latest" href="#" aria-label="Scroll to latest messages">
				<i class="far fa-arrow-down"></i>
			</button>
		</div>
		<form class="saComposer" id="composer">
			<textarea name="message" placeholder="Write your message..." id="prompt" enterkeyhint="send" aria-label="Wrtie your message"></textarea>
			<button type="submit" class="saButtonSend" id="send" disabled aria-label="Send prompt" title="Send prompt">
				<i class="fa-arrow-up saIcon far"></i>
			</button>
			<button type="button" class="saButtonStop" id="stop"
				aria-label="Stop response" title="Stop prompt"
				style="display: none;">
				<i class="fa-stop saIcon fas"></i>
			</button>
		</form>
		<div class="saValidationMessage saError" id="error1"><i class="saIcon fas fa-octagon-xmark" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Error goes here</div></div>
		<div class="saValidationMessage saWarning" id="warning1"><i class="saIcon fas fa-triangle-exclamation" aria-hidden="true"></i><div class="saValidationMessageText" role="alert">Warning goes here</div></div>
		<p class="saComposerInstruction">Please check my work. I'm sickly.</p>
	</div>
</body>
<script>
 $(document).ready(function () {
    // Chat application module
    const ChatApp = (function () {
        // DOM elements
        const $prompt = $('#prompt');
		const $theChat = $('#theChat');
        const $chatLog = $('#chatLog');
        const $latest = $('#latest');
        const $send = $('#send');
        const $stop = $('#stop');
        const $loader = $('#loading');

        // State management
        let state = 'idle'; // idle | thinking
        let responseTimeout = null;

        // Create toolbar for messages
        function createToolbar(isPrompt) {
            const $toolbar = $('<ul>')
                .attr({
                    'role': 'toolbar',
                    'aria-label': 'Message actions'
                })
                .addClass('saChatToolbar');

            const buttons = isPrompt
                ? [
                    { label: 'Edit message', icon: 'pen' },
                    { label: 'Copy message', icon: 'copy' }
                ]
                : [
                    { label: 'Copy message', icon: 'copy' },
                    { label: 'Try again', icon: 'arrow-rotate-right' },
                    { label: 'Crow', icon: 'bird-crow' }
                ];

            buttons.forEach(({ label, icon }) => {
                $toolbar.append(
                    $('<li>').append(
                        $('<button>')
                            .attr({
                                'type': 'button',
                                'aria-label': label
                            })
                            .append($('<i>').addClass(`far fa-${icon} saIcon`))
                    )
                );
            });

            return $toolbar;
        }

        // Update send button state
        function updateSendButton() {
            $send.prop('disabled', !$prompt.val().trim());
        }

        // Manage sparkles animation
        function setLoading(show) {
            $loader
                .toggle(show)
                .attr('aria-busy', show ? 'true' : null);
        }

        // Update chat state
        function setState(newState) {
            state = newState;
            const isThinking = state === 'thinking';

            $send.toggle(!isThinking);
            $stop.toggle(isThinking);

            if (!isThinking) {
                updateSendButton();
            }
        }

        // Send and handle message
        function sendMessage() {
            const message = $prompt.val().trim();
            if (!message || state !== 'idle') return;

            // Add user prompt to chat log
            const lines = message.split(/\r?\n/);
            const $promptLi = $('<li>')
                .addClass('saMessage saSender')
                .append(
                    $('<p>').html(lines.map(line => $('<div>').text(line).html()).join('<br>')),
                    createToolbar(true)
                );
            $chatLog.append($promptLi);

            // Reset input
            $prompt.val('');
            updateSendButton();
            $prompt.focus();
            scrollToBottom();

            // Set thinking state
            setState('thinking');

            // Simulate response with word-by-word reveal
            const responseLines = [
                "Absolutely, I can help you with that.",
                "Here are the steps you should follow:",
                "1. Review the requirements.",
                "2. Implement the necessary changes.",
                "3. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
            ];

            const $responseLi = $('<li>').addClass('saResponse');
            $chatLog.append($responseLi);

            // Split response into words and track paragraph boundaries
            const words = responseLines.join(' ').split(/\s+/);
            const lineWordCounts = responseLines.map(line => line.split(/\s+/).length);
            let wordIndex = 0;
            let currentLineIndex = 0;
            let wordsInCurrentLine = 0;
            let currentP = $('<p>').appendTo($responseLi);

            function revealWord() {
                if (wordIndex < words.length) {
                    if (wordIndex > 0 && wordsInCurrentLine === 0) {
                        currentP = $('<p>').appendTo($responseLi); // Start new paragraph
                    } else if (wordIndex > 0) {
                        currentP.append(' ');
                    }
                    currentP.append($('<span>').text(words[wordIndex]).addClass('saWord'));
                    scrollToBottom();
                    wordIndex++;
                    wordsInCurrentLine++;

                    // Check if current paragraph is complete
                    if (wordsInCurrentLine >= lineWordCounts[currentLineIndex]) {
                        // Replace spans with paragraph text
                        currentP.html($('<div>').text(responseLines[currentLineIndex]).html());
                        currentLineIndex++;
                        wordsInCurrentLine = 0;
                    }

                    responseTimeout = setTimeout(revealWord, 25); // Adjust delay (25ms per word)
                } else {
                    $responseLi.append(createToolbar(false));
                    scrollToBottom();
                    setState('idle');
                }
            }

            // Remove loader and start revealing words after a short delay
            setLoading(false); // Loader removed at response start
            setTimeout(revealWord, 1000);

            // Handle stop button
            $stop.off('click').on('click', function () {
                clearTimeout(responseTimeout);
                // Replace all content with final paragraphs
                const finalHtml = responseLines.map(line => $('<p>').text(line).prop('outerHTML')).join('');
                $responseLi.html(finalHtml);
                $responseLi.append(createToolbar(false));
                setState('idle');
            });
        }

		// Enhanced scroll handler for chat day/date pills
		function enhancedHandleScroll() {

			$(".saChatDate").each(function (index) {
				const $current = $(this);
				const $pill = $current.find('time');
				const $next = $(".saChatDate").eq(index + 1);

				if ($next.length) {
					const distance = $next.offset().top - $current.offset().top;
					// Scale effect
					if (distance <= 100) {
						const scale = Math.max(0, distance / 100).toFixed(2);
						$pill.css("transform", `scale(${scale <= 0.1 ? 0 : scale})`);
					} else {
						$pill.css("transform", "scale(1)");
					}
					// Opacity effect
					if (distance <= 50) {
						const opacity = Math.max(0, distance / 50).toFixed(2);
						$pill.css("opacity", opacity <= 0.1 ? 0 : opacity);
					} else {
						$pill.css("opacity", "1");
					}
				}
			});
		}

        // Scroll chat log to bottom
        function scrollToBottom() {
            $theChat[0].scrollTop = $theChat[0].scrollHeight;
        }

		$('#scrollToBottom').click(function (e) {
			scrollToBottom();
		});

		$latest.click(function (e) {
			scrollToBottom();
		});

        // Handle scroll events
        function handleScroll() {
            const isAtBottom = Math.abs(
                $theChat[0].scrollHeight - $theChat[0].scrollTop - $theChat[0].clientHeight
            ) < 16;
            $latest.toggleClass('saReached', isAtBottom);
			 enhancedHandleScroll();
        }

        // Initialize event listeners
        function initEvents() {
            $prompt.on('input', function () {
                if (state === 'idle') updateSendButton();
            });

            $send.on('click', function (e) {
                e.preventDefault();
                sendMessage();
            });

            $prompt.on('keydown', function (e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            $stop.on('click', function () {
                clearTimeout(responseTimeout);
                setState('idle');
            });

            $theChat.on('scroll', handleScroll);
        }

        // Initialize the chat application
        function init() {
            initEvents();
            updateSendButton();
        }

        return { init };
    })();

    // Start the application
    ChatApp.init();
});
</script>

</html>